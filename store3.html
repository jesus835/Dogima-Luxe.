<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dogima Luxe. - Tienda Completa</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'Coolvetica';
            src: url('./fonts/Coolvetica Rg.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }
        @font-face {
            font-family: 'Malvides';
            src: url('./fonts/Malvides.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }
    </style>
    <script>
        // Redirigir automáticamente al index.html cuando se recarga la página
        window.addEventListener('beforeunload', function() {
            // Solo redirigir si es una recarga (no una navegación normal)
            if (performance.navigation.type === 1) { // 1 = reload
                window.location.href = 'index.html';
            }
        });
        
        // Alternativa más confiable: detectar recarga con performance API
        window.addEventListener('load', function() {
            if (performance.navigation.type === 1) {
                window.location.href = 'index.html';
            }
        });
    </script>
</head>
<body class="store-page store3-page">

    <!-- Main Header -->
    <header class="main-header">
        <div class="container">
            <div class="logo">
                <h1>Dogima Luxe.</h1>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html">Inicio</a></li>
                    <li><a href="store.html">Tienda</a></li>
                    <li><a href="store2.html" class="active">Todos</a></li>
                    <li><a href="store.html#playeras">Playeras Lisas</a></li>
                    <li><a href="store.html#oversize">T-shirt Oversize</a></li>
                    <li><a href="store.html#boxfit">T-shirt Boxfit</a></li>
                    <li><a href="https://wa.me/50257326695?text=Me%20gustaria%20mas%20informacion%20para%20surtir%20mi%20negocio">Contacto</a></li>
                </ul>
            </nav>
            <div class="header-actions">
                <i class="fas fa-user" onclick="openCoupons()"></i>
                <i class="fas fa-search desktop-only"></i>
                <div class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars"></i>
                </div>
                <div class="cart-icon" onclick="openOrders()">
                    <i class="fas fa-receipt"></i>
                    <span class="badge" id="ordersBadge">0</span>
                </div>
                <div class="cart-icon" onclick="openCart()">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="badge">0</span>
                </div>
            </div>
        </div>
        
        <!-- Menú móvil -->
        <div id="mobileMenu" class="mobile-menu">
            <div class="mobile-menu-content">
                <ul>
                    <li><a href="index.html" onclick="closeMobileMenu()">Inicio</a></li>
                    <li><a href="store.html" onclick="closeMobileMenu()">Tienda</a></li>
                    <li class="menu-category">
                        <span class="category-title" onclick="togglePersonalizeCategory()">
                            Personaliza Tu Prenda
                            <i class="fas fa-chevron-down category-arrow"></i>
                        </span>
                        <ul class="category-submenu" id="personalizeSubmenu">
                            <li><a href="store3.html" onclick="closeMobileMenu()">Personalizar</a></li>
                            <li><a href="store3.html#futbol" onclick="closeMobileMenu()">Fútbol</a></li>
                            <li><a href="store3.html#basquetbol" onclick="closeMobileMenu()">Básquetbol</a></li>
                            <li><a href="store3.html#anime" onclick="closeMobileMenu()">Anime</a></li>
                            <li><a href="store3.html#artistas" onclick="closeMobileMenu()">Artistas</a></li>
                        </ul>
                    </li>
                    <li><a href="store2.html" onclick="closeMobileMenu()">Todos los artículos</a></li>
                    <li class="menu-category">
                        <span class="category-title" onclick="toggleCategory()">
                            Categorías
                            <i class="fas fa-chevron-down category-arrow"></i>
                        </span>
                        <ul class="category-submenu" id="categorySubmenu">
                            <li><a href="#playeras" onclick="closeMobileMenu()">Playeras Lisas</a></li>
                            <li><a href="#oversize" onclick="closeMobileMenu()">T-shirt Oversize</a></li>
                            <li><a href="#boxfit" onclick="closeMobileMenu()">T-shirt Boxfit</a></li>
                        </ul>
                    </li>
                    <li><a href="https://wa.me/50257326695?text=Me%20gustaria%20mas%20informacion%20para%20surtir%20mi%20negocio" onclick="closeMobileMenu()">Contacto</a></li>
                </ul>
            </div>
        </div>
    </header>




    <!-- Playeras Lisas Section -->
    <section class="playeras-section" id="playeras">
        <div class="container">
            <div class="section-header">
                <div class="back-arrow" onclick="window.location.href='store.html'">
                    <i class="fas fa-arrow-left"></i>
                    <span>Atrás</span>
                </div>
                <h2>Personaliza Tu Prenda</h2>
            </div>
            <div class="products-count">
                <span></span>
            </div>
            <!-- Carrusel de Playeras -->
            <div class="carousel-container">
                <button class="carousel-arrow left" onclick="prevSlide()">‹</button>
                <button class="carousel-arrow right" onclick="nextSlide()">›</button>
                </div>


                <div class="playera-card" onclick="openPersonalizedOverlay()">
                    <div class="playera-image">
                        <img src="./images/personalizadas/crema.jpg" alt="Personaliza Tu Prenda">
                        <div class="cart-icon-btn" onclick="event.stopPropagation(); openPersonalizedOverlay()">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                    </div>
                    <div class="playera-info">
                        <h4 style="text-align: center;">PERSONALIZA TU PRENDA</h4>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Fútbol Section -->
    <section class="playeras-section" id="futbol">
        <div class="container">
            <div class="section-header">
                <div class="back-arrow" onclick="window.location.href='store.html'">
                    <i class="fas fa-arrow-left"></i>
                    <span>Atrás</span>
                </div>
                <h2>Fútbol</h2>
            </div>
            <div class="products-count">
                <span></span>
            </div>
            <!-- Carrusel de Playeras -->
            <div class="carousel-container">
                <button class="carousel-arrow left" onclick="prevSlide()">‹</button>
                <button class="carousel-arrow right" onclick="nextSlide()">›</button>
                </div>

                <div class="playera-card" onclick="openFutbolOverlay()">
                    <div class="playera-image">
                        <img src="./images/personalizadas/futbol/futbol1.jpg" alt="Fútbol">
                        <div class="cart-icon-btn" onclick="event.stopPropagation(); openFutbolOverlay()">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                    </div>
                    <div class="playera-info">
                        <h4 style="text-align: center;">FÚTBOL</h4>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Básquetbol Section -->
    <section class="playeras-section" id="basquetbol">
        <div class="container">
            <div class="section-header">
                <div class="back-arrow" onclick="window.location.href='store.html'">
                    <i class="fas fa-arrow-left"></i>
                    <span>Atrás</span>
                </div>
                <h2>Básquetbol</h2>
            </div>
            <div class="products-count">
                <span></span>
            </div>
            <!-- Carrusel de Playeras -->
            <div class="carousel-container">
                <button class="carousel-arrow left" onclick="prevSlide()">‹</button>
                <button class="carousel-arrow right" onclick="nextSlide()">›</button>
                </div>

                <div class="playera-card" onclick="openBasqueOverlay()">
                    <div class="playera-image">
                        <img src="./images/personalizadas/basque/basquet1.jpg" alt="Básquetbol">
                        <div class="cart-icon-btn" onclick="event.stopPropagation(); openBasqueOverlay()">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                    </div>
                    <div class="playera-info">
                        <h4 style="text-align: center;">BÁSQUETBOL</h4>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Anime Section -->
    <section class="playeras-section" id="anime">
        <div class="container">
            <div class="section-header">
                <div class="back-arrow" onclick="window.location.href='store.html'">
                    <i class="fas fa-arrow-left"></i>
                    <span>Atrás</span>
                </div>
                <h2>Anime</h2>
            </div>
            <div class="products-count">
                <span></span>
            </div>
            <!-- Carrusel de Playeras -->
            <div class="carousel-container">
                <button class="carousel-arrow left" onclick="prevSlide()">‹</button>
                <button class="carousel-arrow right" onclick="nextSlide()">›</button>
                </div>

                <div class="playera-card" onclick="openAnimeOverlay()">
                    <div class="playera-image">
                        <img src="./images/personalizadas/anime/anime1.jpg" alt="Anime">
                        <div class="cart-icon-btn" onclick="event.stopPropagation(); openAnimeOverlay()">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                    </div>
                    <div class="playera-info">
                        <h4 style="text-align: center;">ANIME</h4>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Artistas Section -->
    <section class="playeras-section" id="artistas">
        <div class="container">
            <div class="section-header">
                <div class="back-arrow" onclick="window.location.href='store.html'">
                    <i class="fas fa-arrow-left"></i>
                    <span>Atrás</span>
                </div>
                <h2>Artistas</h2>
            </div>
            <div class="products-count">
                <span></span>
            </div>
            <!-- Carrusel de Playeras -->
            <div class="carousel-container">
                <button class="carousel-arrow left" onclick="prevSlide()">‹</button>
                <button class="carousel-arrow right" onclick="nextSlide()">›</button>
                </div>

                <div class="playera-card" onclick="openArtistasOverlay()">
                    <div class="playera-image">
                        <img src="./images/personalizadas/artistas/artistas1.jpg" alt="Artistas">
                        <div class="cart-icon-btn" onclick="event.stopPropagation(); openArtistasOverlay()">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                    </div>
                    <div class="playera-info">
                        <h4 style="text-align: center;">ARTISTAS</h4>
                    </div>
                </div>
            </div>
        </div>
    </section>
        
        <style>
            .personalized-notice {
                background: #e3f2fd;
                border: 1px solid #2196f3;
                border-radius: 8px;
                padding: 15px;
                margin: 10px 0;
                display: flex;
                align-items: flex-start;
                gap: 10px;
            }
            
            .personalized-notice i {
                color: #2196f3;
                font-size: 18px;
                margin-top: 2px;
            }
            
            .personalized-notice p {
                margin: 0;
                color: #1976d2;
                font-size: 14px;
                line-height: 1.4;
            }
            
            .store-page .playeras-section,
            .store-page #playeras,
            section.playeras-section,
            section#playeras {
                padding: 10px 0 !important;
                background: white !important;
                background-color: #ffffff !important;
                min-height: 300px !important;
            }
            
            .section-header {
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                margin-bottom: 5px !important;
                margin-top: 10px !important;
                position: relative !important;
                width: 100% !important;
                transform: translateY(10px) !important;
            }
            
            .back-arrow {
                position: absolute !important;
                left: 0 !important;
                top: -40% !important;
                display: flex !important;
                align-items: center !important;
                gap: 8px !important;
                color: #999 !important;
                font-size: 14px !important;
                cursor: pointer !important;
                transform: translateY(-40%) !important;
            }
            
            .store-page .playeras-section .section-header h2,
            .store-page #playeras .section-header h2,
            section.playeras-section .section-header h2,
            section#playeras .section-header h2 {
                font-size: 18px !important;
                font-weight: normal !important;
                margin: 0 !important;
                color: #000 !important;
                text-align: center !important;
                padding-bottom: 5px !important;
            }
            
            .products-count {
                color: #999;
                font-size: 14px;
                margin-bottom: 30px;
            }
            
            .playeras-grid {
                display: grid;
                grid-template-columns: repeat(5, 1fr);
                gap: 15px;
                margin: 0 auto;
            }
            
            .playera-card {
                background: white;
                border-radius: 15px;
                overflow: hidden;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                cursor: pointer;
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }
            
            .playera-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            }
            
            .playera-image {
                position: relative;
                aspect-ratio: 1.4;
                background: #2a2a2a;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .playera-image img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            
            .star-badge {
                position: absolute;
                top: 10px;
                left: 10px;
                background: #ff6b00;
                color: white;
                width: 30px;
                height: 30px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 12px;
                z-index: 2;
            }
            
            .cart-icon-btn {
                position: absolute;
                top: 10px;
                right: 10px;
                background: #000;
                color: white;
                width: 30px;
                height: 30px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 12px;
                cursor: pointer;
                transition: background 0.3s ease;
                z-index: 2;
            }
            
            .cart-icon-btn:hover {
                background: #333;
            }
            
            /* Eliminar selección y efectos de toque */
            .playera-card,
            .cart-icon-btn,
            .star-badge,
            .back-arrow {
                -webkit-tap-highlight-color: transparent !important;
                -webkit-touch-callout: none !important;
                -webkit-user-select: none !important;
                -moz-user-select: none !important;
                -ms-user-select: none !important;
                user-select: none !important;
                outline: none !important;
                border: none !important;
            }
            
            .playera-card:focus,
            .cart-icon-btn:focus,
            .star-badge:focus,
            .back-arrow:focus {
                outline: none !important;
                box-shadow: none !important;
                border: none !important;
            }
            
            .playera-info {
                padding: 15px;
                text-align: left;
            }
            
            .playera-info h4 {
                font-size: 12px;
                font-weight: bold;
                margin: 0 0 8px 0;
                color: #333;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
            
            .playera-price {
                font-size: 14px;
                font-weight: bold;
                color: #000;
            }
            
            @media (max-width: 768px) {
                .store-page .playeras-section,
                .store-page #playeras,
                section.playeras-section,
                section#playeras {
                    background: white !important;
                    background-color: #ffffff !important;
                    padding: 15px 0 !important;
                }
                
                .store-page .playeras-section .section-header h2,
                .store-page #playeras .section-header h2,
                section.playeras-section .section-header h2,
                section#playeras .section-header h2 {
                    color: #000 !important;
                }
                
                .playeras-grid {
                    grid-template-columns: repeat(2, 1fr) !important;
                    max-width: 100%;
                    margin: 0;
                    gap: 15px;
                }
                
                .playera-card {
                    border-radius: 12px;
                }
                
                .playera-info {
                    padding: 12px;
                }
                
                .playera-info h4 {
                    font-size: 11px;
                }
            }
            
            /* Estilos para el Overlay Unificado de Producto */
            .product-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: #f5f5f5;
                z-index: 10000;
                display: none;
                flex-direction: column;
            }
            
            /* Asegurar que el modal de zoom aparezca encima del overlay */
            #imageZoomModal {
                z-index: 10001 !important;
            }
            
            .modal {
                display: none;
                position: fixed;
                z-index: 1000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0,0,0,0.8);
                overflow: auto;
            }
            
            .modal-content {
                background-color: #fefefe;
                margin: 5% auto;
                padding: 20px;
                border: none;
                width: 90%;
                max-width: 800px;
                border-radius: 10px;
                position: relative;
            }
            
            .image-zoom-modal {
                background: white;
                border-radius: 15px;
                overflow: hidden;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            }
            
            .close {
                color: #aaa;
                float: right;
                font-size: 28px;
                font-weight: bold;
                cursor: pointer;
                position: absolute;
                top: 15px;
                right: 20px;
                z-index: 1001;
            }
            
            .close:hover,
            .close:focus {
                color: #000;
                text-decoration: none;
            }
            
            .zoom-image-container {
                position: relative;
                width: 100%;
                height: 400px;
                overflow: hidden;
            }
            
            .zoom-carousel-container {
                width: 100%;
                height: 100%;
                position: relative;
            }
            
            #zoomImage {
                width: 100%;
                height: 100%;
                object-fit: contain;
                cursor: grab;
            }
            
            .carousel-dots {
                display: flex;
                justify-content: center;
                gap: 8px;
                margin-top: 15px;
            }
            
            .carousel-dots .dot {
                width: 10px;
                height: 10px;
                border-radius: 50%;
                background-color: #ccc;
                cursor: pointer;
                transition: background-color 0.3s;
            }
            
            .carousel-dots .dot.active {
                background-color: #333;
            }
            
            .zoom-image-info {
                padding: 20px;
                text-align: center;
            }
            
            .zoom-image-info h3 {
                margin: 0 0 10px 0;
                color: #333;
                font-size: 24px;
            }
            
            .zoom-image-info p {
                margin: 0;
                color: #666;
                font-size: 16px;
                line-height: 1.5;
            }
            
            .overlay-header {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                height: 60px;
                background: white;
                display: flex;
                align-items: center;
                padding: 0 20px;
                z-index: 10001;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            
            .back-btn {
                background: none;
                border: none;
                font-size: 20px;
                color: #333;
                cursor: pointer;
                padding: 10px;
            }
            
            .overlay-content {
                flex: 1;
                padding-top: 60px;
                padding-bottom: 100px;
            overflow-y: auto;
                display: flex;
                flex-direction: column;
            }
            
            .product-image-section {
                padding: 10px 20px 5px;
            }
            
            .image-card {
                background: white;
                border-radius: 15px;
                padding: 15px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                position: relative;
            }
            
            .image-container {
                position: relative;
                display: flex;
                align-items: center;
                justify-content: center;
                width: 100%;
                height: 200px;
                overflow: hidden;
                border-radius: 10px;
            }
            
            .image-container img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            
            
            .image-dots {
                position: absolute;
                bottom: 10px;
                left: 50%;
                transform: translateX(-50%);
                display: flex;
                flex-direction: row;
                gap: 8px;
                background: rgba(0, 0, 0, 0.7);
                padding: 8px 12px;
                border-radius: 20px;
            }
            
            .dot {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background: white;
                cursor: pointer;
                transition: opacity 0.3s ease;
                opacity: 0.5;
            }
            
            .dot.active {
                background: white;
                opacity: 1;
            }
            
            .product-info-section {
                padding: 3px 20px 8px;
                flex: 1;
                margin: 0 20px 10px 20px;
            }
            
            .product-sku {
                font-size: 11px;
                color: #999;
                text-transform: uppercase;
                margin-bottom: 3px;
                font-weight: 400;
            }
            
            .product-title {
                font-size: 16px;
                font-weight: bold;
                color: #333;
                text-transform: uppercase;
                margin-bottom: 12px;
                line-height: 1.2;
            }
            
            .description-section, .specification-section {
                margin-bottom: 12px;
            }
            
            .description-header, .spec-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                font-weight: bold;
                color: #333;
                margin-bottom: 6px;
                cursor: pointer;
                font-size: 14px;
            }
            
            .description-header i, .spec-header i {
                color: #666;
                font-size: 12px;
            }
            
            .description-text {
                color: #666;
                line-height: 1.4;
                font-size: 13px;
            }
            
            .spec-content {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }
            
            
            .spec-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .spec-item span {
                color: #333;
                font-weight: 500;
            }
            
            .spec-item select {
                padding: 8px 12px;
                border: 1px solid #ddd;
                border-radius: 8px;
                background: white;
                color: #333;
            }
            
            .quantity-controls {
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .quantity-controls button {
                width: 28px;
                height: 28px;
                border: 1px solid #ddd;
                background: white;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                color: #333;
                font-size: 14px;
            }
            
            .quantity-controls input {
                width: 45px;
                text-align: center;
                border: 1px solid #ddd;
                border-radius: 6px;
                padding: 6px;
                font-size: 14px;
            }
            
            .discount-info {
                background: #e8f5e8;
                color: #2e7d32;
                padding: 8px 12px;
                border-radius: 6px;
                font-size: 12px;
                font-weight: 500;
                margin-top: 8px;
                text-align: center;
                border-left: 3px solid #4caf50;
            }
            
            .overlay-footer {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: white;
                padding: 15px 20px;
                box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .price-section {
                display: flex;
                flex-direction: column;
                gap: 2px;
            }
            
            .price-label {
                font-size: 11px;
                color: #999;
            }
            
            .discount-applied {
                font-size: 10px;
                color: #4caf50;
                font-weight: bold;
            }
            
            .price-value {
                font-size: 16px;
                font-weight: bold;
                color: #333;
            }
            
            .discount-info {
                font-size: 10px;
                color: #4caf50;
                font-weight: bold;
            }
            
            .action-buttons {
                display: flex;
                align-items: center;
                gap: 15px;
            }
            
            .wishlist-btn {
                width: 45px;
                height: 45px;
                border: 1px solid #ddd;
                background: white;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                color: #666;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                margin-left: 5%;
            }
            
            .add-to-cart-btn {
                background: #333;
                color: white;
                border: none;
                padding: 12px 20px;
                border-radius: 20px;
                font-weight: bold;
                text-transform: uppercase;
                cursor: pointer;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                transition: background 0.3s ease;
                font-size: 13px;
            }
            
            .add-to-cart-btn:hover {
                background: #555;
            }

        /* Estilos del Carrusel */
        .carousel-container {
            position: relative;
            max-width: 100%;
            margin: 10px auto;
            overflow: hidden;
        }

        .carousel-wrapper {
            overflow: hidden;
            width: 100%;
        }

        .carousel-track {
            display: flex;
            transition: transform 0.5s ease;
            gap: 10px;
        }

        .carousel-track .playera-card {
            flex: 0 0 200px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .carousel-track .playera-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .carousel-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 24px;
            cursor: pointer;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
        }

        .carousel-arrow:hover {
            background: white;
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
            transform: translateY(-50%) scale(1.1);
        }

        .carousel-arrow.left {
            left: 10px;
        }

        .carousel-arrow.right {
            right: 10px;
        }
        
        #personalizedColorSelect {
            max-height: 120px;
            overflow-y: auto;
        }
        
        #personalizedThreadSelect:disabled {
            cursor: not-allowed;
        }
            
            @media (max-width: 768px) {
                .overlay-content {
                    padding-bottom: 120px;
                }
                
                .overlay-footer {
                    padding: 12px 15px;
                }
                
                .product-title {
                    font-size: 15px;
                }
                
                .add-to-cart-btn {
                    padding: 10px 16px;
                    font-size: 12px;
                }
                
                .image-container {
                    aspect-ratio: 16/9;
                }
            }
        </style>
    </section>





    <!-- Bottom Navigation (solo en móvil) -->
    <nav class="bottom-nav mobile-only">
        <div class="nav-item active" onclick="window.location.href='store2.html'">
            <i class="fas fa-th-large"></i>
            <span>Todos</span>
        </div>
        <div class="nav-item" onclick="window.location.href='store.html#playeras'">
            <i class="fas fa-tshirt"></i>
            <span>Playeras</span>
        </div>
        <div class="nav-item" onclick="window.location.href='store.html#oversize'">
            <i class="fas fa-user-tie"></i>
            <span>Oversize</span>
        </div>
        <div class="nav-item" onclick="window.location.href='store.html#boxfit'">
            <i class="fas fa-box"></i>
            <span>Boxfit</span>
        </div>
        <div class="nav-item" onclick="openCouponsModal()">
            <i class="fas fa-user"></i>
            <span>Cupones</span>
        </div>
    </nav>

    <!-- Cart Modal -->
    <div id="cartModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCartModal()">&times;</span>
            <div class="modal-product">
                <img id="modalProductImage" src="" alt="Producto">
                <div class="modal-details">
                    <h3 id="modalProductName"></h3>
                    <p id="modalProductInfo"></p>
                    
                    <div class="size-selector">
                        <label for="sizeSelect">Talla:</label>
                        <select id="sizeSelect">
                            <option value="S">S</option>
                            <option value="M" selected>M</option>
                            <option value="L">L</option>
                            <option value="XL">XL</option>
                        </select>
                    </div>
                    
                    <div class="quantity-selector">
                        <label>Cantidad:</label>
                        <div class="quantity-controls">
                            <button onclick="decreaseQuantity()">-</button>
                            <input type="number" id="quantityInput" value="1" min="1" max="50">
                            <button onclick="increaseQuantity()">+</button>
                        </div>
                    </div>
                    
                    <div class="coupon-selector" id="couponSection" style="display: none;">
                        <label>Código de Cupón:</label>
                        <div class="coupon-input-container">
                            <input type="text" id="couponCode" placeholder="Ingresa tu código" onchange="applyCoupon()">
                            <button class="btn-apply-coupon" onclick="applyCoupon()">Aplicar</button>
                        </div>
                        <div class="coupon-status" id="couponStatus"></div>
                    </div>
                    
                    <div class="price-summary">
                        <div class="unit-price">Precio unitario: <span id="unitPrice">Q25</span></div>
                        <div class="discount-applied" id="discountApplied" style="display: none;">Descuento aplicado</div>
                        <div class="total-price">Total: <span id="totalPrice">Q25</span></div>
                        <div class="discount-info" id="discountInfo" style="display: none;">
                            ¡Descuento aplicado! Precio por docena: Q18 c/u
                        </div>
                    </div>
                    
                    <button class="btn-add-to-cart" onclick="addToCart()">Agregar al Carrito</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal del Carrito de Compras -->
    <div id="shoppingCartModal" class="modal">
        <div class="modal-content cart-modal">
            <span class="close" onclick="closeCart()">&times;</span>
            
            <div id="cartItems" class="cart-items">
                <!-- Los productos se cargarán dinámicamente aquí -->
            </div>
            
            <div id="emptyCart" class="empty-cart" style="display: none;">
                <i class="fas fa-shopping-cart"></i>
                <p>Tu carrito está vacío</p>
                <p>¡Agrega algunas playeras para comenzar!</p>
            </div>
            
            <div id="cartSummary" class="cart-summary" style="display: none;">
                <div class="summary-row">
                    <span>Subtotal:</span>
                    <span id="cartSubtotal">Q0</span>
                </div>
                <div class="summary-row">
                    <span>Envío:</span>
                    <span id="cartShipping">Q30</span>
                </div>
                <div class="summary-row">
                    <span>Total de productos:</span>
                    <span id="cartTotalItems">0</span>
                </div>
                <div class="summary-row total">
                    <span>Total:</span>
                    <span id="cartTotal">Q0</span>
                </div>
                
                <div class="cart-actions">
                    <button class="btn-clear-cart" onclick="clearCart()">Vaciar Carrito</button>
                    <button class="btn-checkout" onclick="checkout()">Proceder al Checkout</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Pedidos -->
    <div id="ordersModal" class="modal">
        <div class="modal-content orders-modal">
            <span class="close" onclick="closeOrders()">&times;</span>
            <h2>Mis Pedidos</h2>
            
            <div id="ordersItems" class="orders-items">
                <!-- Los pedidos se cargarán dinámicamente aquí -->
            </div>
            
            <div id="emptyOrders" class="empty-orders" style="display: none;">
                <i class="fas fa-receipt"></i>
                <p>No tienes pedidos activos</p>
                <p>¡Haz tu primer pedido en nuestras playeras!</p>
            </div>
        </div>
    </div>

    <!-- Modal de Cupones -->
    <div id="couponsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCouponsModal()">&times;</span>
            <div class="modal-header">
                <h2>¡Cupones de Descuento!</h2>
            </div>
            
            <div id="couponsContainer" class="coupons-container">
                <!-- Los cupones se cargarán dinámicamente aquí -->
            </div>
            
            <div class="coupons-info">
                <p><i class="fas fa-info-circle"></i> Los cupones se renuevan cada 24 horas. ¡Cada cupón solo se puede usar una vez!</p>
            </div>
        </div>
    </div>

    <!-- Modal de Zoom de Imagen -->
    <div id="imageZoomModal" class="modal">
        <div class="modal-content image-zoom-modal">
            <span class="close" onclick="closeImageZoomModal()">&times;</span>
            <div class="zoom-image-container">
                <div class="zoom-carousel-container" id="zoomCarouselContainer" style="overflow: hidden; position: relative;">
                    <img id="zoomImage" src="" alt="Imagen del producto" 
                         onwheel="handleImageZoom(event)" 
                         onmousedown="startImageDrag(event)"
                         onmousemove="dragImage(event)"
                         onmouseup="endImageDrag()"
                         onmouseleave="endImageDrag()"
                         ontouchstart="handleTouchStart(event)"
                         ontouchmove="handleTouchMove(event)"
                         ontouchend="handleTouchEnd(event)"
                         ondragstart="return false"
                         style="cursor: grab; transform-origin: center; transition: transform 0.1s; touch-action: none;">
                </div>
                <div class="carousel-dots" id="zoomCarouselDots" style="display: none;"></div>
            </div>
            <div class="zoom-image-info">
                <h3 id="zoomProductName"></h3>
                <p id="zoomProductDetails"></p>
            </div>
        </div>
    </div>

    <!-- Overlay Unificado de Producto (Nuevo) -->
    <div id="productOverlay" class="product-overlay">
        <div class="overlay-header">
            <button class="back-btn" onclick="closeProductOverlay()">
                <i class="fas fa-arrow-left"></i>
            </button>
        </div>
        
        <div class="overlay-content">
            <!-- Sección de imagen del producto -->
            <div class="product-image-section">
                <div class="image-card">
                    <div class="image-container">
                        <img id="overlayProductImage" src="" alt="Producto" 
                             onwheel="handleOverlayImageZoom(event)" 
                             onmousedown="startOverlayImageDrag(event)"
                             onmousemove="dragOverlayImage(event)"
                             onmouseup="endOverlayImageDrag(event)"
                             onmouseleave="endOverlayImageDrag(event)"
                             ontouchstart="handleOverlayTouchStart(event)"
                             ontouchmove="handleOverlayTouchMove(event)"
                             ontouchend="handleOverlayTouchEnd(event)"
                             ondragstart="return false"
                             title="Haz clic para ver imagen más grande"
                             style="cursor: pointer; transform-origin: center; transition: transform 0.1s; touch-action: none;">
                        <div class="image-dots">
                            <div class="dot active" id="dot1"></div>
                            <div class="dot" id="dot2"></div>
                            <div class="dot" id="dot3"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sección de información del producto -->
            <div class="product-info-section">
                <div class="product-sku" id="overlayProductSku">DOGIMA LUXE</div>
                <div class="product-title" id="overlayProductTitle">PLAYERA DE ALTA CALIDAD</div>
                
                <div class="description-section">
                    <div class="description-header">
                        <span>Descripción</span>
                        <i class="fas fa-minus"></i>
                    </div>
                    <div class="description-text" id="overlayProductDescription">
                        Playera de alta calidad, 100% algodón, perfecta para cualquier ocasión. Diseño moderno y cómodo.
                    </div>
                </div>
                
                <div class="specification-section">
                    <div class="spec-header">
                        <span>Especificaciones</span>
                        <i class="fas fa-minus"></i>
                    </div>
                    <div class="spec-content">
                        <div class="spec-item">
                            <span>Talla:</span>
                            <select id="overlaySizeSelect">
                                <option value="S">S</option>
                                <option value="M" selected>M</option>
                                <option value="L">L</option>
                                <option value="XL">XL</option>
                            </select>
                        </div>
                        <div class="spec-item">
                            <span>Cantidad:</span>
                            <div class="quantity-controls">
                                <button onclick="decreaseOverlayQuantity()">-</button>
                                <input type="number" id="overlayQuantityInput" value="1" min="1" max="50" onchange="updateOverlayPrice()">
                                <button onclick="increaseOverlayQuantity()">+</button>
                            </div>
                        </div>
                        <div class="discount-info" id="overlayDiscountInfo" style="display: none;"></div>
                    </div>
                </div>
                
            </div>
        </div>
        
        <!-- Footer fijo con precio y botones -->
        <div class="overlay-footer">
            <div class="price-section">
                <div class="price-label">Precio unitario: <span id="overlayUnitPrice">Q25</span></div>
                <div class="discount-applied" id="overlayDiscountApplied" style="display: none;">Descuento aplicado</div>
                <div class="price-value">Total: <span id="overlayTotalPrice">Q25</span></div>
            </div>
            <div class="action-buttons">
                <button class="wishlist-btn">
                    <i class="far fa-heart"></i>
                </button>
                <button class="add-to-cart-btn" onclick="addToCartFromOverlay()">
                    AGREGAR AL CARRITO
                </button>
            </div>
        </div>
    </div>

    <!-- Overlay Específico para Camisas Personalizadas -->
    <div id="personalizedOverlay" class="product-overlay" style="display: none;">
        <div class="overlay-header">
            <button class="back-btn" onclick="closePersonalizedOverlay()">
                <i class="fas fa-arrow-left"></i>
            </button>
        </div>
        
        <div class="overlay-content">
            <!-- Sección de imagen del producto -->
            <div class="product-image-section">
                <div class="image-card">
                    <div class="image-container">
                                <img id="personalizedProductImage" src="./images/personalizadas/crema.jpg" alt="Producto Personalizado" 
                                     onclick="openImageZoomModal('PERSONALIZA TU PRENDA', 'Personaliza tu playera con diseños únicos. Elige el tipo de playera, color, talla y agrega tu diseño personalizado.', './images/personalizadas/crema.jpg')"
                                     onwheel="handlePersonalizedImageZoom(event)" 
                                     onmousedown="startPersonalizedImageDrag(event)"
                                     onmousemove="dragPersonalizedImage(event)"
                                     onmouseup="endPersonalizedImageDrag(event)"
                                     onmouseleave="endPersonalizedImageDrag(event)"
                                     ontouchstart="handlePersonalizedTouchStart(event)"
                                     ontouchmove="handlePersonalizedTouchMove(event)"
                                     ontouchend="handlePersonalizedTouchEnd(event)"
                                     ondragstart="return false"
                                     title="Haz clic para ver imagen más grande"
                                     style="cursor: pointer; transform-origin: center; transition: transform 0.1s; touch-action: none;">
                    </div>
                </div>
            </div>
            
            <!-- Sección de información del producto -->
            <div class="product-info-section">
                <div class="product-sku" id="personalizedProductSku">PERSONALIZACIÓN</div>
                <div class="product-title" id="personalizedProductTitle">PERSONALIZA TU PRENDA</div>
                
                <div class="description-section">
                    <div class="description-header">
                        <span>Descripción</span>
                        <i class="fas fa-minus"></i>
                    </div>
                    <div class="description-text" id="personalizedProductDescription">
                        Personaliza tu playera con diseños únicos. Elige el tipo de playera, color, talla y agrega tu diseño personalizado.
                    </div>
                </div>
                
                <div class="specification-section">
                    <div class="spec-header">
                        <span>Especificaciones</span>
                        <i class="fas fa-minus"></i>
                    </div>
                    <div class="spec-content">
                        <div class="spec-item">
                            <span>Tipo de Playera:</span>
                            <select id="personalizedTypeSelect" onchange="updatePersonalizedColors()">
                                <option value="lisa">Playera Lisa</option>
                                <option value="oversize">T-shirt Oversize</option>
                                <option value="boxfit">T-shirt Boxfit</option>
                                <option value="hoodie_con_capucha">Hoodie con Capucha</option>
                                <option value="hoodie_sin_capucha">Hoodie sin Capucha</option>
                            </select>
                        </div>
                        <div class="spec-item">
                            <span>Color:</span>
                            <select id="personalizedColorSelect">
                                <option value="blanco">Blanco</option>
                                <option value="negro">Negro</option>
                                <option value="celeste">Celeste</option>
                                <option value="rojo">Rojo</option>
                                <option value="verde">Verde</option>
                                <option value="gris">Gris</option>
                                <option value="azul">Azul</option>
                                <option value="amarillo">Amarillo</option>
                                <option value="naranja">Naranja</option>
                                <option value="corinto">Corinto</option>
                                <option value="fucsia">Fucsia</option>
                                <option value="verdemilitar">Verde Militar</option>
                            </select>
                        </div>
                        <div class="spec-item">
                            <span>Talla:</span>
                            <select id="personalizedSizeSelect">
                                <option value="S">S</option>
                                <option value="M" selected>M</option>
                                <option value="L">L</option>
                                <option value="XL">XL</option>
                            </select>
                        </div>
                        <div class="spec-item">
                            <span>Tipo de Hilo:</span>
                            <select id="personalizedThreadSelect" disabled>
                                <option value="hilo22">Hilo 22 - Q75</option>
                                <option value="hilo20">Hilo 20 - Q110</option>
                            </select>
                        </div>
                        <div class="spec-item">
                            <span>Cantidad:</span>
                            <div class="quantity-controls">
                                <button onclick="decreasePersonalizedQuantity()">-</button>
                                <input type="number" id="personalizedQuantityInput" value="1" min="1" max="50" onchange="updatePersonalizedPrice()">
                                <button onclick="increasePersonalizedQuantity()">+</button>
                            </div>
                        </div>
                        <div class="discount-info" id="personalizedDiscountInfo" style="display: none;"></div>
                    </div>
                </div>
                
            </div>
        </div>
        
        <!-- Footer fijo con precio y botones -->
        <div class="overlay-footer">
            <div class="price-section">
                <div class="price-value">Total: <span id="personalizedTotalPrice">Q75</span></div>
            </div>
            <div class="action-buttons">
                <button class="wishlist-btn">
                    <i class="far fa-heart"></i>
                </button>
                <button class="add-to-cart-btn" onclick="addPersonalizedToCart()">
                    PERSONALIZAR
                </button>
            </div>
        </div>
    </div>

    <!-- Overlay para Fútbol -->
    <div id="futbolOverlay" class="product-overlay" style="display: none;">
        <div class="overlay-header">
            <button class="back-btn" onclick="closeFutbolOverlay()">
                <i class="fas fa-arrow-left"></i>
            </button>
        </div>
        
        <div class="overlay-content">
            <div class="product-image-section">
                <div class="image-card">
                    <div class="image-container">
                        <img id="futbolProductImage" src="./images/personalizadas/futbol/futbol1.jpg" alt="Fútbol Personalizado" 
                             onclick="openImageZoomModal('FÚTBOL', 'Personaliza tu playera de fútbol con diseños únicos.', './images/personalizadas/futbol/futbol1.jpg')"
                             onwheel="handlePersonalizedImageZoom(event)" 
                             onmousedown="startPersonalizedImageDrag(event)"
                             onmousemove="dragPersonalizedImage(event)"
                             onmouseup="endPersonalizedImageDrag(event)"
                             onmouseleave="endPersonalizedImageDrag(event)"
                             ontouchstart="handlePersonalizedTouchStart(event)"
                             ontouchmove="handlePersonalizedTouchMove(event)"
                             ontouchend="handlePersonalizedTouchEnd(event)"
                             ondragstart="return false"
                             title="Haz clic para ver imagen más grande"
                             style="cursor: pointer; transform-origin: center; transition: transform 0.1s; touch-action: none;">
                    </div>
                </div>
            </div>
            
            <div class="product-info-section">
                <div class="product-sku">FÚTBOL</div>
                <div class="product-title">FÚTBOL PERSONALIZADO</div>
                
                <div class="description-section">
                    <div class="description-header">
                        <span>Descripción</span>
                        <i class="fas fa-minus"></i>
                    </div>
                    <div class="description-text">
                        Personaliza tu playera de fútbol con diseños únicos. Elige el tipo de playera, color, talla y agrega tu diseño personalizado.
                    </div>
                </div>
                
                <div class="specification-section">
                    <div class="spec-header">
                        <span>Especificaciones</span>
                        <i class="fas fa-minus"></i>
                    </div>
                    <div class="spec-content">
                        <div class="spec-item">
                            <span>Tipo de Playera:</span>
                            <select id="futbolTypeSelect" onchange="updateFutbolColors()">
                                <option value="lisa">Playera Lisa</option>
                                <option value="oversize">T-shirt Oversize</option>
                                <option value="boxfit">T-shirt Boxfit</option>
                                <option value="hoodie_con_capucha">Hoodie con Capucha</option>
                                <option value="hoodie_sin_capucha">Hoodie sin Capucha</option>
                            </select>
                        </div>
                        <div class="spec-item">
                            <span>Color:</span>
                            <select id="futbolColorSelect">
                                <option value="blanco">Blanco</option>
                                <option value="negro">Negro</option>
                                <option value="celeste">Celeste</option>
                                <option value="rojo">Rojo</option>
                                <option value="verde">Verde</option>
                                <option value="gris">Gris</option>
                                <option value="azul">Azul</option>
                                <option value="amarillo">Amarillo</option>
                                <option value="naranja">Naranja</option>
                                <option value="corinto">Corinto</option>
                                <option value="fucsia">Fucsia</option>
                                <option value="verdemilitar">Verde Militar</option>
                            </select>
                        </div>
                        <div class="spec-item">
                            <span>Talla:</span>
                            <select id="futbolSizeSelect">
                                <option value="S">S</option>
                                <option value="M" selected>M</option>
                                <option value="L">L</option>
                                <option value="XL">XL</option>
                            </select>
                        </div>
                        <div class="spec-item">
                            <span>Tipo de Hilo:</span>
                            <select id="futbolThreadSelect" disabled>
                                <option value="hilo22">Hilo 22 - Q75</option>
                                <option value="hilo20">Hilo 20 - Q110</option>
                            </select>
                        </div>
                        <div class="spec-item">
                            <span>Cantidad:</span>
                            <div class="quantity-controls">
                                <button onclick="decreaseFutbolQuantity()">-</button>
                                <input type="number" id="futbolQuantityInput" value="1" min="1" max="50" onchange="updateFutbolPrice()">
                                <button onclick="increaseFutbolQuantity()">+</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="overlay-footer">
            <div class="price-section">
                <div class="price-value">Total: <span id="futbolTotalPrice">Q75</span></div>
            </div>
            <div class="action-buttons">
                <button class="wishlist-btn">
                    <i class="far fa-heart"></i>
                </button>
                <button class="add-to-cart-btn" onclick="addFutbolToCart()">
                    PERSONALIZAR
                </button>
            </div>
        </div>
    </div>

    <!-- Overlay para Básquetbol -->
    <div id="basqueOverlay" class="product-overlay" style="display: none;">
        <div class="overlay-header">
            <button class="back-btn" onclick="closeBasqueOverlay()">
                <i class="fas fa-arrow-left"></i>
            </button>
        </div>
        
        <div class="overlay-content">
            <div class="product-image-section">
                <div class="image-card">
                    <div class="image-container">
                        <img id="basqueProductImage" src="./images/personalizadas/basque/basquet1.jpg" alt="Básquetbol Personalizado" 
                             onclick="openImageZoomModal('BÁSQUETBOL', 'Personaliza tu playera de básquetbol con diseños únicos.', './images/personalizadas/basque/basquet1.jpg')"
                             onwheel="handlePersonalizedImageZoom(event)" 
                             onmousedown="startPersonalizedImageDrag(event)"
                             onmousemove="dragPersonalizedImage(event)"
                             onmouseup="endPersonalizedImageDrag(event)"
                             onmouseleave="endPersonalizedImageDrag(event)"
                             ontouchstart="handlePersonalizedTouchStart(event)"
                             ontouchmove="handlePersonalizedTouchMove(event)"
                             ontouchend="handlePersonalizedTouchEnd(event)"
                             ondragstart="return false"
                             title="Haz clic para ver imagen más grande"
                             style="cursor: pointer; transform-origin: center; transition: transform 0.1s; touch-action: none;">
                    </div>
                </div>
            </div>
            
            <div class="product-info-section">
                <div class="product-sku">BÁSQUETBOL</div>
                <div class="product-title">BÁSQUETBOL PERSONALIZADO</div>
                
                <div class="description-section">
                    <div class="description-header">
                        <span>Descripción</span>
                        <i class="fas fa-minus"></i>
                    </div>
                    <div class="description-text">
                        Personaliza tu playera de básquetbol con diseños únicos. Elige el tipo de playera, color, talla y agrega tu diseño personalizado.
                    </div>
                </div>
                
                <div class="specification-section">
                    <div class="spec-header">
                        <span>Especificaciones</span>
                        <i class="fas fa-minus"></i>
                    </div>
                    <div class="spec-content">
                        <div class="spec-item">
                            <span>Tipo de Playera:</span>
                            <select id="basqueTypeSelect" onchange="updateBasqueColors()">
                                <option value="lisa">Playera Lisa</option>
                                <option value="oversize">T-shirt Oversize</option>
                                <option value="boxfit">T-shirt Boxfit</option>
                                <option value="hoodie_con_capucha">Hoodie con Capucha</option>
                                <option value="hoodie_sin_capucha">Hoodie sin Capucha</option>
                            </select>
                        </div>
                        <div class="spec-item">
                            <span>Color:</span>
                            <select id="basqueColorSelect">
                                <option value="blanco">Blanco</option>
                                <option value="negro">Negro</option>
                                <option value="celeste">Celeste</option>
                                <option value="rojo">Rojo</option>
                                <option value="verde">Verde</option>
                                <option value="gris">Gris</option>
                                <option value="azul">Azul</option>
                                <option value="amarillo">Amarillo</option>
                                <option value="naranja">Naranja</option>
                                <option value="corinto">Corinto</option>
                                <option value="fucsia">Fucsia</option>
                                <option value="verdemilitar">Verde Militar</option>
                            </select>
                        </div>
                        <div class="spec-item">
                            <span>Talla:</span>
                            <select id="basqueSizeSelect">
                                <option value="S">S</option>
                                <option value="M" selected>M</option>
                                <option value="L">L</option>
                                <option value="XL">XL</option>
                            </select>
                        </div>
                        <div class="spec-item">
                            <span>Tipo de Hilo:</span>
                            <select id="basqueThreadSelect" disabled>
                                <option value="hilo22">Hilo 22 - Q75</option>
                                <option value="hilo20">Hilo 20 - Q110</option>
                            </select>
                        </div>
                        <div class="spec-item">
                            <span>Cantidad:</span>
                            <div class="quantity-controls">
                                <button onclick="decreaseBasqueQuantity()">-</button>
                                <input type="number" id="basqueQuantityInput" value="1" min="1" max="50" onchange="updateBasquePrice()">
                                <button onclick="increaseBasqueQuantity()">+</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="overlay-footer">
            <div class="price-section">
                <div class="price-value">Total: <span id="basqueTotalPrice">Q75</span></div>
            </div>
            <div class="action-buttons">
                <button class="wishlist-btn">
                    <i class="far fa-heart"></i>
                </button>
                <button class="add-to-cart-btn" onclick="addBasqueToCart()">
                    PERSONALIZAR
                </button>
            </div>
        </div>
    </div>

    <!-- Overlay para Anime -->
    <div id="animeOverlay" class="product-overlay" style="display: none;">
        <div class="overlay-header">
            <button class="back-btn" onclick="closeAnimeOverlay()">
                <i class="fas fa-arrow-left"></i>
            </button>
        </div>
        
        <div class="overlay-content">
            <div class="product-image-section">
                <div class="image-card">
                    <div class="image-container">
                        <img id="animeProductImage" src="./images/personalizadas/anime/anime1.jpg" alt="Anime Personalizado" 
                             onclick="openImageZoomModal('ANIME', 'Personaliza tu playera de anime con diseños únicos.', './images/personalizadas/anime/anime1.jpg')"
                             onwheel="handlePersonalizedImageZoom(event)" 
                             onmousedown="startPersonalizedImageDrag(event)"
                             onmousemove="dragPersonalizedImage(event)"
                             onmouseup="endPersonalizedImageDrag(event)"
                             onmouseleave="endPersonalizedImageDrag(event)"
                             ontouchstart="handlePersonalizedTouchStart(event)"
                             ontouchmove="handlePersonalizedTouchMove(event)"
                             ontouchend="handlePersonalizedTouchEnd(event)"
                             ondragstart="return false"
                             title="Haz clic para ver imagen más grande"
                             style="cursor: pointer; transform-origin: center; transition: transform 0.1s; touch-action: none;">
                    </div>
                </div>
            </div>
            
            <div class="product-info-section">
                <div class="product-sku">ANIME</div>
                <div class="product-title">ANIME PERSONALIZADO</div>
                
                <div class="description-section">
                    <div class="description-header">
                        <span>Descripción</span>
                        <i class="fas fa-minus"></i>
                    </div>
                    <div class="description-text">
                        Personaliza tu playera de anime con diseños únicos. Elige el tipo de playera, color, talla y agrega tu diseño personalizado.
                    </div>
                </div>
                
                <div class="specification-section">
                    <div class="spec-header">
                        <span>Especificaciones</span>
                        <i class="fas fa-minus"></i>
                    </div>
                    <div class="spec-content">
                        <div class="spec-item">
                            <span>Tipo de Playera:</span>
                            <select id="animeTypeSelect" onchange="updateAnimeColors()">
                                <option value="lisa">Playera Lisa</option>
                                <option value="oversize">T-shirt Oversize</option>
                                <option value="boxfit">T-shirt Boxfit</option>
                                <option value="hoodie_con_capucha">Hoodie con Capucha</option>
                                <option value="hoodie_sin_capucha">Hoodie sin Capucha</option>
                            </select>
                        </div>
                        <div class="spec-item">
                            <span>Color:</span>
                            <select id="animeColorSelect">
                                <option value="blanco">Blanco</option>
                                <option value="negro">Negro</option>
                                <option value="celeste">Celeste</option>
                                <option value="rojo">Rojo</option>
                                <option value="verde">Verde</option>
                                <option value="gris">Gris</option>
                                <option value="azul">Azul</option>
                                <option value="amarillo">Amarillo</option>
                                <option value="naranja">Naranja</option>
                                <option value="corinto">Corinto</option>
                                <option value="fucsia">Fucsia</option>
                                <option value="verdemilitar">Verde Militar</option>
                            </select>
                        </div>
                        <div class="spec-item">
                            <span>Talla:</span>
                            <select id="animeSizeSelect">
                                <option value="S">S</option>
                                <option value="M" selected>M</option>
                                <option value="L">L</option>
                                <option value="XL">XL</option>
                            </select>
                        </div>
                        <div class="spec-item">
                            <span>Tipo de Hilo:</span>
                            <select id="animeThreadSelect" disabled>
                                <option value="hilo22">Hilo 22 - Q75</option>
                                <option value="hilo20">Hilo 20 - Q110</option>
                            </select>
                        </div>
                        <div class="spec-item">
                            <span>Cantidad:</span>
                            <div class="quantity-controls">
                                <button onclick="decreaseAnimeQuantity()">-</button>
                                <input type="number" id="animeQuantityInput" value="1" min="1" max="50" onchange="updateAnimePrice()">
                                <button onclick="increaseAnimeQuantity()">+</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="overlay-footer">
            <div class="price-section">
                <div class="price-value">Total: <span id="animeTotalPrice">Q75</span></div>
            </div>
            <div class="action-buttons">
                <button class="wishlist-btn">
                    <i class="far fa-heart"></i>
                </button>
                <button class="add-to-cart-btn" onclick="addAnimeToCart()">
                    PERSONALIZAR
                </button>
            </div>
        </div>
    </div>

    <!-- Overlay para Artistas -->
    <div id="artistasOverlay" class="product-overlay" style="display: none;">
        <div class="overlay-header">
            <button class="back-btn" onclick="closeArtistasOverlay()">
                <i class="fas fa-arrow-left"></i>
            </button>
        </div>
        
        <div class="overlay-content">
            <div class="product-image-section">
                <div class="image-card">
                    <div class="image-container">
                        <img id="artistasProductImage" src="./images/personalizadas/artistas/artistas1.jpg" alt="Artistas Personalizado" 
                             onclick="openImageZoomModal('ARTISTAS', 'Personaliza tu playera de artistas con diseños únicos.', './images/personalizadas/artistas/artistas1.jpg')"
                             onwheel="handlePersonalizedImageZoom(event)" 
                             onmousedown="startPersonalizedImageDrag(event)"
                             onmousemove="dragPersonalizedImage(event)"
                             onmouseup="endPersonalizedImageDrag(event)"
                             onmouseleave="endPersonalizedImageDrag(event)"
                             ontouchstart="handlePersonalizedTouchStart(event)"
                             ontouchmove="handlePersonalizedTouchMove(event)"
                             ontouchend="handlePersonalizedTouchEnd(event)"
                             ondragstart="return false"
                             title="Haz clic para ver imagen más grande"
                             style="cursor: pointer; transform-origin: center; transition: transform 0.1s; touch-action: none;">
                    </div>
                </div>
            </div>
            
            <div class="product-info-section">
                <div class="product-sku">ARTISTAS</div>
                <div class="product-title">ARTISTAS PERSONALIZADO</div>
                
                <div class="description-section">
                    <div class="description-header">
                        <span>Descripción</span>
                        <i class="fas fa-minus"></i>
                    </div>
                    <div class="description-text">
                        Personaliza tu playera de artistas con diseños únicos. Elige el tipo de playera, color, talla y agrega tu diseño personalizado.
                    </div>
                </div>
                
                <div class="specification-section">
                    <div class="spec-header">
                        <span>Especificaciones</span>
                        <i class="fas fa-minus"></i>
                    </div>
                    <div class="spec-content">
                        <div class="spec-item">
                            <span>Tipo de Playera:</span>
                            <select id="artistasTypeSelect" onchange="updateArtistasColors()">
                                <option value="lisa">Playera Lisa</option>
                                <option value="oversize">T-shirt Oversize</option>
                                <option value="boxfit">T-shirt Boxfit</option>
                                <option value="hoodie_con_capucha">Hoodie con Capucha</option>
                                <option value="hoodie_sin_capucha">Hoodie sin Capucha</option>
                            </select>
                        </div>
                        <div class="spec-item">
                            <span>Color:</span>
                            <select id="artistasColorSelect">
                                <option value="blanco">Blanco</option>
                                <option value="negro">Negro</option>
                                <option value="celeste">Celeste</option>
                                <option value="rojo">Rojo</option>
                                <option value="verde">Verde</option>
                                <option value="gris">Gris</option>
                                <option value="azul">Azul</option>
                                <option value="amarillo">Amarillo</option>
                                <option value="naranja">Naranja</option>
                                <option value="corinto">Corinto</option>
                                <option value="fucsia">Fucsia</option>
                                <option value="verdemilitar">Verde Militar</option>
                            </select>
                        </div>
                        <div class="spec-item">
                            <span>Talla:</span>
                            <select id="artistasSizeSelect">
                                <option value="S">S</option>
                                <option value="M" selected>M</option>
                                <option value="L">L</option>
                                <option value="XL">XL</option>
                            </select>
                        </div>
                        <div class="spec-item">
                            <span>Tipo de Hilo:</span>
                            <select id="artistasThreadSelect" disabled>
                                <option value="hilo22">Hilo 22 - Q75</option>
                                <option value="hilo20">Hilo 20 - Q110</option>
                            </select>
                        </div>
                        <div class="spec-item">
                            <span>Cantidad:</span>
                            <div class="quantity-controls">
                                <button onclick="decreaseArtistasQuantity()">-</button>
                                <input type="number" id="artistasQuantityInput" value="1" min="1" max="50" onchange="updateArtistasPrice()">
                                <button onclick="increaseArtistasQuantity()">+</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="overlay-footer">
            <div class="price-section">
                <div class="price-value">Total: <span id="artistasTotalPrice">Q75</span></div>
            </div>
            <div class="action-buttons">
                <button class="wishlist-btn">
                    <i class="far fa-heart"></i>
                </button>
                <button class="add-to-cart-btn" onclick="addArtistasToCart()">
                    PERSONALIZAR
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Datos del Cliente -->
    <div id="customerDataModal" class="modal">
        <div class="modal-content customer-modal">
            <span class="close" onclick="closeCustomerDataModal()">&times;</span>
            <h2>Datos de Entrega</h2>
            <p>Por favor completa tus datos para proceder con el pedido:</p>
            
            <form id="customerDataForm" class="customer-form">
                <div class="form-group">
                    <label for="customerName">Nombre Completo *</label>
                    <input type="text" id="customerName" name="customerName" required>
                </div>
                
                <div class="form-group">
                    <label for="customerPhone">Número de Teléfono *</label>
                    <input type="tel" id="customerPhone" name="customerPhone" placeholder="502 1234-5678" required>
                </div>
                
                <div class="form-group">
                    <label for="customerAddress">Dirección Completa *</label>
                    <textarea id="customerAddress" name="customerAddress" rows="3" placeholder="Calle, número, zona, colonia..." required></textarea>
                </div>
                
                <div class="form-group">
                    <div class="personalized-notice">
                        <i class="fas fa-info-circle"></i>
                        <p><strong>Nota importante:</strong> Si tu pedido incluye productos personalizados, por favor envía tu diseño al finalizar el proceso de compra.</p>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="closeCustomerDataModal()">Cancelar</button>
                    <button type="submit" class="btn-proceed">Proceder al Pedido</button>
                </div>
            </form>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="json/data-loader.js"></script>
    <script>
        // Función para toggle de categorías en menú móvil
        function toggleCategory() {
            const submenu = document.getElementById('categorySubmenu');
            const arrow = document.querySelector('.category-arrow');
            
            if (submenu && arrow) {
                submenu.classList.toggle('expanded');
                arrow.classList.toggle('rotated');
            }
        }

        // Función para toggle de personalizar en menú móvil
        function togglePersonalizeCategory() {
            const submenu = document.getElementById('personalizeSubmenu');
            const arrow = document.querySelector('#personalizeSubmenu').parentElement.querySelector('.category-arrow');
            
            if (submenu && arrow) {
                submenu.classList.toggle('expanded');
                arrow.classList.toggle('rotated');
            }
        }
        
        // Funciones específicas para las secciones de Oversize y Boxfit
        function filterOversizeProducts(category, sectionId) {
            const productItems = document.querySelectorAll('#oversizeGrid .product-item');
            const infoCard = document.querySelector('#oversizeGrid .product-item[style*="grid-column"]');
            const tabButtons = document.querySelectorAll('#oversize-tabs .tab-btn');
            
            const topSellingColors = ['Blanco', 'Negro', 'Gris', 'Azul', 'Rojo'];
            
            // Hacer fade out de productos visibles
            productItems.forEach(item => {
                if (item !== infoCard && item.style.display !== 'none') {
                    item.style.opacity = '0';
                    item.style.transform = 'translateY(10px)';
                }
            });
            
            setTimeout(() => {
                let productsToShow = [];
                
                productItems.forEach(item => {
                    const productTitle = item.querySelector('h4');
                    if (!productTitle || item === infoCard) return;
                    
                    const colorName = productTitle.textContent.replace('Color ', '');
                    
                    if (category === 'T-shirt Oversize') {
                        productsToShow.push({item: item, color: colorName});
                    } else if (category === 'Más Vendidos') {
                        if (topSellingColors.includes(colorName)) {
                            productsToShow.push(item);
                        }
                    } else if (category === 'Mejor Valorados') {
                        const topRated = ['Negro', 'Blanco', 'Azul', 'Verde', 'Gris', 'Rojo'];
                        if (topRated.includes(colorName)) {
                            productsToShow.push(item);
                        }
                    }
                });
                
                // Ordenar según la categoría
                if (category === 'T-shirt Oversize') {
                    const blancoItem = productsToShow.find(p => p.color === 'Blanco');
                    const negroItem = productsToShow.find(p => p.color === 'Negro');
                    const otrosItems = productsToShow.filter(p => p.color !== 'Blanco' && p.color !== 'Negro');
                    
                    otrosItems.sort((a, b) => a.color.localeCompare(b.color));
                    
                    productsToShow = [];
                    if (blancoItem) productsToShow.push(blancoItem.item);
                    if (negroItem) productsToShow.push(negroItem.item);
                    otrosItems.forEach(p => productsToShow.push(p.item));
                } else {
                    productsToShow = shuffleArray(productsToShow);
                }
                
                // Ocultar todos los productos primero
                productItems.forEach(item => {
                    if (item !== infoCard) {
                        item.style.display = 'none';
                        item.style.opacity = '0';
                        item.style.transform = 'translateY(10px)';
                    }
                });
                
                // Reorganizar el DOM y mostrar los productos seleccionados
                const productsGrid = document.querySelector('#oversizeGrid');
                
                productsToShow.forEach(item => {
                    if (item.parentNode) {
                        item.parentNode.removeChild(item);
                    }
                });
                
                productsToShow.forEach((item, index) => {
                    productsGrid.insertBefore(item, infoCard);
                    
                    setTimeout(() => {
                        item.style.display = 'block';
                        setTimeout(() => {
                            item.style.opacity = '1';
                            item.style.transform = 'translateY(0)';
                        }, 10);
                    }, index * 80);
                });
                
            }, 250);
            
            // Actualizar botones activos solo para esta sección
            tabButtons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`#oversize-tabs .tab-btn[onclick*="${category}"]`).classList.add('active');
        }

        function filterBoxfitProducts(category, sectionId) {
            const productItems = document.querySelectorAll('#boxfitGrid .product-item');
            const infoCard = document.querySelector('#boxfitGrid .product-item[style*="grid-column"]');
            const tabButtons = document.querySelectorAll('#boxfit-tabs .tab-btn');
            
            const topSellingColors = ['Blanco', 'Negro', 'Gris', 'Azul', 'Rojo'];
            
            // Hacer fade out de productos visibles
            productItems.forEach(item => {
                if (item !== infoCard && item.style.display !== 'none') {
                    item.style.opacity = '0';
                    item.style.transform = 'translateY(10px)';
                }
            });
            
            setTimeout(() => {
                let productsToShow = [];
                
                productItems.forEach(item => {
                    const productTitle = item.querySelector('h4');
                    if (!productTitle || item === infoCard) return;
                    
                    const colorName = productTitle.textContent.replace('Color ', '');
                    
                    if (category === 'T-shirt Boxfit') {
                        productsToShow.push({item: item, color: colorName});
                    } else if (category === 'Más Vendidos') {
                        if (topSellingColors.includes(colorName)) {
                            productsToShow.push(item);
                        }
                    } else if (category === 'Mejor Valorados') {
                        const topRated = ['Negro', 'Blanco', 'Azul', 'Verde', 'Gris', 'Rojo'];
                        if (topRated.includes(colorName)) {
                            productsToShow.push(item);
                        }
                    }
                });
                
                // Ordenar según la categoría
                if (category === 'T-shirt Boxfit') {
                    const blancoItem = productsToShow.find(p => p.color === 'Blanco');
                    const negroItem = productsToShow.find(p => p.color === 'Negro');
                    const otrosItems = productsToShow.filter(p => p.color !== 'Blanco' && p.color !== 'Negro');
                    
                    otrosItems.sort((a, b) => a.color.localeCompare(b.color));
                    
                    productsToShow = [];
                    if (blancoItem) productsToShow.push(blancoItem.item);
                    if (negroItem) productsToShow.push(negroItem.item);
                    otrosItems.forEach(p => productsToShow.push(p.item));
                } else {
                    productsToShow = shuffleArray(productsToShow);
                }
                
                // Ocultar todos los productos primero
                productItems.forEach(item => {
                    if (item !== infoCard) {
                        item.style.display = 'none';
                        item.style.opacity = '0';
                        item.style.transform = 'translateY(10px)';
                    }
                });
                
                // Reorganizar el DOM y mostrar los productos seleccionados
                const productsGrid = document.querySelector('#boxfitGrid');
                
                productsToShow.forEach(item => {
                    if (item.parentNode) {
                        item.parentNode.removeChild(item);
                    }
                });
                
                productsToShow.forEach((item, index) => {
                    productsGrid.insertBefore(item, infoCard);
                    
                    setTimeout(() => {
                        item.style.display = 'block';
                        setTimeout(() => {
                            item.style.opacity = '1';
                            item.style.transform = 'translateY(0)';
                        }, 10);
                    }, index * 80);
                });
                
            }, 250);
            
            // Actualizar botones activos solo para esta sección
            tabButtons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`#boxfit-tabs .tab-btn[onclick*="${category}"]`).classList.add('active');
        }

        // Popular: elegir 3 productos al azar de todas las categorías
        function populatePopular() {
            const allItems = [];
            // Playeras lisas (Q25)
            const lisas = [
                { name: 'Negro', id: 'negro', price: 25, display: 'Negro' },
                { name: 'Blanco', id: 'blanco', price: 25, display: 'Blanco' },
                { name: 'Azul', id: 'azul', price: 25, display: 'Azul' },
                { name: 'Gris', id: 'gris', price: 25, display: 'Gris' },
                { name: 'Rojo', id: 'rojo', price: 25, display: 'Rojo' },
                { name: 'Amarillo', id: 'amarillo', price: 25, display: 'Amarillo' },
                { name: 'Verde', id: 'verde', price: 25, display: 'Verde' }
            ];
            lisas.forEach(c => allItems.push({ productName: c.name, imageId: c.id, price: c.price, display: c.display }));

            // Oversize (Q45)
            const oversize = [
                { name: 'Blanco Oversize', id: 'blanco', price: 45, display: 'Blanco (Oversize)' },
                { name: 'Negro Oversize', id: 'negro', price: 45, display: 'Negro (Oversize)' },
                { name: 'Azul Oversize', id: 'azul', price: 45, display: 'Azul (Oversize)' }
            ];
            oversize.forEach(c => allItems.push({ productName: c.name, imageId: c.id, price: c.price, display: c.display }));

            // Boxfit (Q45)
            const boxfit = [
                { name: 'Blanco Boxfit', id: 'blanco', price: 45, display: 'Blanco (Boxfit)' },
                { name: 'Negro Boxfit', id: 'negro', price: 45, display: 'Negro (Boxfit)' },
                { name: 'Azul Boxfit', id: 'azul', price: 45, display: 'Azul (Boxfit)' }
            ];
            boxfit.forEach(c => allItems.push({ productName: c.name, imageId: c.id, price: c.price, display: c.display }));

            // Mezclar y tomar 3
            const shuffled = allItems.sort(() => Math.random() - 0.5).slice(0, 3);
            const grid = document.getElementById('popularGrid');
            grid.innerHTML = '';
            shuffled.forEach(item => {
                const card = document.createElement('div');
                card.className = 'popular-card';
                card.onclick = () => openProductOverlay(item.productName, item.imageId, item.price);
                card.innerHTML = `
                    <img src="./images/camisas lisas/${item.imageId}.png" alt="${item.display}">
                    <div class="popular-info">
                        <span class="popular-name">${item.display}</span>
                        <span class="popular-price">Q${item.price}</span>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            updateOrdersBadge();
            // Poblar sección Popular
            populatePopular();
        });
        
        // Función para mostrar las tarjetas de productos con animación
        function showProductCards() {
            // Primero hacer visible los grids agregando la clase 'ready'
            const productsGrids = document.querySelectorAll('.products-grid');
            productsGrids.forEach(grid => {
                grid.classList.add('ready');
            });
            
            // Luego animar las tarjetas
            const productItems = document.querySelectorAll('.product-item');
            productItems.forEach((item, index) => {
                setTimeout(() => {
                    item.style.opacity = '1';
                    item.style.transform = 'translateY(0px)';
                }, index * 100); // Retraso escalonado para cada tarjeta
            });
        }
        
        // Ejecutar cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', function() {
            showProductCards();
        });
        
        // También ejecutar cuando la página esté completamente cargada
        window.addEventListener('load', function() {
            showProductCards();
        });
    </script>
    
    <script>
        // Variables para el zoom y arrastre de imagen
        let currentScale = 1;
        let isDragging = false;
        let startX = 0;
        let startY = 0;
        let translateX = 0;
        let translateY = 0;
        
        // Función para manejar el zoom con la rueda del mouse
        function handleImageZoom(event) {
            event.preventDefault();
            const img = document.getElementById('zoomImage');
            const delta = event.deltaY * -0.01;
            
            // Límites de zoom
            const minScale = 1.0;
            const maxScale = 5;
            
            currentScale += delta;
            currentScale = Math.min(Math.max(minScale, currentScale), maxScale);
            
            // Si regresamos al tamaño original, centrar la imagen
            if (currentScale === 1) {
                translateX = 0;
                translateY = 0;
            }
            
            updateImageTransform(img);
        }
        
        // Función para iniciar el arrastre
        function startImageDrag(event) {
            if (currentScale > 1) {
                isDragging = true;
                startX = event.clientX - translateX;
                startY = event.clientY - translateY;
                
                const img = document.getElementById('zoomImage');
                img.style.cursor = 'grabbing';
                img.style.transition = 'none';
            }
        }
        
        // Función para arrastrar la imagen
        function dragImage(event) {
            if (isDragging && currentScale > 1) {
                const newTranslateX = event.clientX - startX;
                const newTranslateY = event.clientY - startY;
                
                const img = document.getElementById('zoomImage');
                const container = img.parentElement;
                
                // Calcular límites basados en el tamaño de la imagen y el contenedor
                const imgRect = img.getBoundingClientRect();
                const containerRect = container.getBoundingClientRect();
                
                const scaledWidth = imgRect.width;
                const scaledHeight = imgRect.height;
                const containerWidth = containerRect.width;
                const containerHeight = containerRect.height;
                
                // Calcular límites máximos de movimiento
                const maxTranslateX = Math.max(0, (scaledWidth - containerWidth) / 2 / currentScale);
                const maxTranslateY = Math.max(0, (scaledHeight - containerHeight) / 2 / currentScale);
                
                // Aplicar límites
                translateX = Math.max(-maxTranslateX, Math.min(maxTranslateX, newTranslateX));
                translateY = Math.max(-maxTranslateY, Math.min(maxTranslateY, newTranslateY));
                
                updateImageTransform(img);
            }
        }
        
        // Función para terminar el arrastre
        function endImageDrag() {
            if (isDragging) {
                isDragging = false;
                const img = document.getElementById('zoomImage');
                img.style.cursor = currentScale > 1 ? 'grab' : 'default';
                img.style.transition = 'transform 0.1s';
            }
        }
        
        // Función para actualizar la transformación de la imagen
        function updateImageTransform(img) {
            img.style.transform = `scale(${currentScale}) translate(${translateX/currentScale}px, ${translateY/currentScale}px)`;
        }
        
        // Resetear zoom cuando se abre una nueva imagen
        function resetImageZoom() {
            currentScale = 1;
            translateX = 0;
            translateY = 0;
            isDragging = false;
            
            const img = document.getElementById('zoomImage');
            if (img) {
                img.style.transform = 'scale(1) translate(0px, 0px)';
                img.style.cursor = 'default';
            }
        }
        
        // Sobrescribir la función original de apertura del modal para resetear el zoom
        const originalOpenProductImageModal = window.openProductImageModal;
        if (originalOpenProductImageModal) {
            window.openProductImageModal = function(...args) {
                originalOpenProductImageModal.apply(this, args);
                setTimeout(resetImageZoom, 100);
            };
        }
        
        // Agregar doble clic para resetear zoom cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', function() {
            const zoomImg = document.getElementById('zoomImage');
            if (zoomImg) {
                zoomImg.addEventListener('dblclick', function() {
                    resetImageZoom();
                });
            }
        });
    </script>
    
    <!-- Funciones para el Overlay Unificado -->
    <script>
        // Variables para el overlay
        let overlayCurrentImageIndex = 0;
        let overlayProductImages = [];
        let overlayCurrentProduct = null;
        let overlayCurrentProductColor = '';
        let overlayCurrentProductType = 'lisa'; // lisa | oversize | boxfit
        
        // Variables para zoom y drag en overlay
        let overlayCurrentScale = 1;
        let overlayIsDragging = false;
        let overlayStartX = 0;
        let overlayStartY = 0;
        let overlayTranslateX = 0;
        let overlayTranslateY = 0;
        let overlayMouseDownTime = 0;
        let overlayMouseDownX = 0;
        let overlayMouseDownY = 0;
        
        // Variables para gestos táctiles en overlay
        let overlayIsZooming = false;
        let overlayInitialDistance = 0;
        let overlayInitialScale = 1;
        let overlayTouches = [];
        let overlayLastTouchDistance = 0;
        let overlayLastTouchTime = 0;
        let overlayTouchCount = 0;
        let overlaySwipeStartX = 0;
        let overlaySwipeStartY = 0;
        let overlaySwipeThreshold = 50;
        
        // Función para obtener precio unitario (copiada del script.js)
        function getOverlayUnitPriceFor(quantity, productName) {
            const name = (productName || '').toLowerCase();
            
            if (name.includes('oversize') || name.includes('boxfit')) {
                if (quantity >= 12) return 35; // Docena
                if (quantity >= 6) return 38;  // Media docena
                return 45; // Individual
            } else {
                // Playeras lisas
                if (quantity >= 12) return 18; // Docena
                return 25; // Individual
            }
        }
        
        // Función para actualizar precio en overlay
        function updateOverlayPrice() {
            const quantity = parseInt(document.getElementById('overlayQuantityInput').value);
            const unitPrice = getOverlayUnitPriceFor(quantity, overlayCurrentProductColor);
            const total = unitPrice * quantity;
            
            document.getElementById('overlayUnitPrice').textContent = `Q${unitPrice}`;
            document.getElementById('overlayTotalPrice').textContent = `Q${total}`;
            
            const discountInfo = document.getElementById('overlayDiscountInfo');
            
            if (overlayCurrentProductType === 'lisa') {
                // Mostrar info solo para docena en lisas
                discountInfo.style.display = quantity >= 12 ? 'block' : 'none';
                discountInfo.textContent = quantity >= 12 ? 'Precio por docena aplicado (Q18 c/u)' : '';
            } else {
                // Oversize y Boxfit: mostrar tier activo
                if (quantity >= 12) {
                    discountInfo.style.display = 'block';
                    discountInfo.textContent = 'Precio por docena aplicado (Q35 c/u)';
                } else if (quantity >= 6) {
                    discountInfo.style.display = 'block';
                    discountInfo.textContent = 'Precio por media docena aplicado (Q38 c/u)';
                } else {
                    discountInfo.style.display = 'none';
                    discountInfo.textContent = '';
                }
            }
        }
        
        
        // Función para abrir el overlay unificado
        function openProductOverlay(productName, imageSource, price) {
            // Determinar la ruta correcta de la imagen
            let imagePath;
            if (imageSource.startsWith('./images/')) {
                imagePath = imageSource;
            } else {
                imagePath = `./images/camisas lisas/${imageSource}.png`;
            }
            
            // Generar array de imágenes para este producto
            overlayProductImages = getOverlayProductImages(productName, imageSource);
            overlayCurrentImageIndex = 0;
            
            // Configurar la información del producto
            document.getElementById('overlayProductSku').textContent = 'DOGIMA LUXE';
            document.getElementById('overlayProductTitle').textContent = productName.toUpperCase();
            document.getElementById('overlayProductDescription').textContent = 'Playera de alta calidad, 100% algodón, perfecta para cualquier ocasión. Diseño moderno y cómodo.';
            document.getElementById('overlayPrice').textContent = `Q${price}.00`;
            
            // Configurar imagen principal
            document.getElementById('overlayProductImage').src = overlayProductImages[0];
            
            // Configurar dots
            setupOverlayDots();
            
            // Resetear valores del formulario
            document.getElementById('overlaySizeSelect').value = 'M';
            document.getElementById('overlayQuantityInput').value = '1';
            
            // Guardar datos del producto actual
            overlayCurrentProduct = {
                name: productName,
                image: imagePath,
                price: price
            };
            
            // Mostrar el overlay
            document.getElementById('productOverlay').style.display = 'flex';
        }
        
        // Función para detectar imágenes disponibles (copiada del script.js)
        function detectOverlayAvailableImages(colorName, imageId) {
            const images = [];
            
            // Obtener carpeta y extensión según el tipo de producto
            let imageFolder = 'camisas lisas';
            let extension = '.png';
            
            if (overlayCurrentProductType === 'oversize') {
                imageFolder = 'overside';
                extension = '.jpg';
            } else if (overlayCurrentProductType === 'boxfit') {
                imageFolder = 'T-shirt Boxifit';
                extension = '.jpg';
            }
            
            // Si imageId ya es una ruta completa, usarla
            if (imageId && (imageId.includes('/') || imageId.includes('.'))) {
                images.push(imageId);
                return images;
            }
            
            // Usar el nombre exacto del archivo base
            const baseFileName = imageId || colorName.toLowerCase();
            
            // Solo agregar la imagen base por defecto
            const baseImagePath = `./images/${imageFolder}/${baseFileName}${extension}`;
            images.push(baseImagePath);
            
            return images;
        }
        
        // Función para verificar si una imagen existe
        function checkOverlayImageExists(imagePath) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => resolve(true);
                img.onerror = () => resolve(false);
                img.src = imagePath;
            });
        }
        
        // Función para cargar imágenes adicionales
        async function loadOverlayAdditionalImages() {
            if (overlayProductImages.length === 0) return;
            
            const basePath = overlayProductImages[0];
            const pathParts = basePath.split('/');
            const fileName = pathParts[pathParts.length - 1];
            const baseName = fileName.split('.')[0];
            const extension = fileName.split('.')[1];
            const folder = pathParts.slice(0, -1).join('/');
            
            const additionalImages = [];
            
            // Verificar imágenes numeradas
            for (let i = 1; i <= 10; i++) {
                const numberedPath = `${folder}/${baseName}${i}.${extension}`;
                
                try {
                    const exists = await checkOverlayImageExists(numberedPath);
                    if (exists) {
                        additionalImages.push(numberedPath);
                    }
                } catch (error) {
                    // Imagen no existe, continuar
                }
            }
            
            // Agregar imágenes adicionales al array principal
            overlayProductImages.push(...additionalImages);
            
            // Actualizar el carrusel
            updateOverlayCarouselDisplay();
        }
        
        // Función para actualizar la visualización del carrusel
        function updateOverlayCarouselDisplay() {
            const dotsContainer = document.querySelector('.image-dots');
            
            // Mostrar/ocultar dots
            if (overlayProductImages.length > 1) {
                if (dotsContainer) {
                    dotsContainer.style.display = 'flex';
                    dotsContainer.innerHTML = '';
                    overlayProductImages.forEach((_, index) => {
                        const dot = document.createElement('div');
                        dot.className = `dot ${index === overlayCurrentImageIndex ? 'active' : ''}`;
                        dot.onclick = () => goToOverlayImage(index);
                        dotsContainer.appendChild(dot);
                    });
                }
            } else {
                if (dotsContainer) {
                    dotsContainer.style.display = 'none';
                }
            }
        }
        
        // Función para configurar los dots del carousel (compatibilidad)
        function setupOverlayDots() {
            updateOverlayCarouselDisplay();
        }
        
        // Función para ir a una imagen específica en el overlay
        function goToOverlayImage(index) {
            if (index >= 0 && index < overlayProductImages.length) {
                overlayCurrentImageIndex = index;
                const overlayImg = document.getElementById('overlayProductImage');
                if (overlayImg && overlayProductImages[index]) {
                    overlayImg.src = overlayProductImages[index];
                }
                
                // Actualizar dots
                document.querySelectorAll('.image-dots .dot').forEach((dot, i) => {
                    dot.classList.toggle('active', i === index);
                });
                
                // Resetear zoom al cambiar imagen
                setTimeout(resetOverlayImageZoom, 100);
            }
        }
        
        // Función para cambiar imagen en el overlay (compatibilidad)
        function changeOverlayImage(index) {
            goToOverlayImage(index);
        }
        
        
        // Función para abrir el modal de zoom desde el overlay
        
        function openImageZoomModal(productName, productDetails, imageSrc) {
            console.log('Abriendo modal de zoom:', productName, imageSrc);
            const modal = document.getElementById('imageZoomModal');
            const zoomImage = document.getElementById('zoomImage');
            const zoomProductName = document.getElementById('zoomProductName');
            const zoomProductDetails = document.getElementById('zoomProductDetails');
            
            console.log('Elementos encontrados:', {modal, zoomImage, zoomProductName, zoomProductDetails});
            
            if (modal && zoomImage && zoomProductName && zoomProductDetails) {
                // Detectar imágenes disponibles para productos personalizados
                const personalizedImages = detectPersonalizedAvailableImages(imageSrc);
                
                // Configurar las variables globales para el carrusel
                carouselImages = personalizedImages;
                currentImageIndex = 0;
                currentProductColor = productName;
                currentProductType = 'personalized';
                
                // Resetear zoom y posición
                modalCurrentScale = 1;
                modalTranslateX = 0;
                modalTranslateY = 0;
                
                // Configurar la imagen inicial
                zoomImage.src = imageSrc;
                zoomProductName.textContent = productName;
                zoomProductDetails.textContent = productDetails;
                
                // Actualizar transformación inicial
                updateModalImageTransform(zoomImage);
                
                // Mostrar/ocultar puntos del carrusel según las imágenes disponibles
                updateModalCarouselDisplay();
                
                // Cargar imágenes adicionales de forma asíncrona
                loadModalAdditionalImages();
                
                console.log('Mostrando modal...');
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
                console.log('Modal mostrado');
            } else {
                console.log('Error: No se encontraron todos los elementos necesarios');
            }
        }
        
        function detectPersonalizedAvailableImages(imageSrc) {
            const images = [];
            
            // Agregar la imagen principal
            images.push(imageSrc);
            
            // Detectar imágenes adicionales (crema1.jpg, crema2.jpg, etc.)
            const basePath = imageSrc.replace('.jpg', '');
            for (let i = 1; i <= 10; i++) {
                const additionalImage = basePath + i + '.jpg';
                images.push(additionalImage);
            }
            
            return images;
        }
        
        function closeImageZoomModal() {
            const modal = document.getElementById('imageZoomModal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }
        
        function goToZoomImage(index) {
            if (carouselImages && carouselImages[index]) {
                const zoomImage = document.getElementById('zoomImage');
                if (zoomImage) {
                    zoomImage.src = carouselImages[index];
                    currentImageIndex = index;
                    
                    // Actualizar puntos activos
                    const dots = document.querySelectorAll('#zoomCarouselDots .dot');
                    dots.forEach((dot, i) => {
                        dot.classList.toggle('active', i === index);
                    });
                }
            }
        }
        
        // Variables para zoom y drag en el modal
        let modalCurrentScale = 1;
        let modalTranslateX = 0;
        let modalTranslateY = 0;
        let modalIsDragging = false;
        let modalIsZooming = false;
        let modalInitialDistance = 0;
        let modalInitialScale = 1;
        let modalStartX = 0;
        let modalStartY = 0;
        let modalTouches = [];
        
        // Función para manejar zoom con rueda del mouse
        function handleImageZoom(event) {
            event.preventDefault();
            const zoomImage = document.getElementById('zoomImage');
            if (!zoomImage) return;
            
            const delta = event.deltaY > 0 ? 0.9 : 1.1;
            modalCurrentScale *= delta;
            modalCurrentScale = Math.max(0.5, Math.min(3, modalCurrentScale));
            
            updateModalImageTransform(zoomImage);
        }
        
        // Variables para gestos con mouse
        let modalMouseStartX = 0;
        let modalMouseStartY = 0;
        let modalIsMouseSwipe = false;
        
        // Función para iniciar arrastre con mouse
        function startImageDrag(event) {
            modalIsMouseSwipe = true;
            modalMouseStartX = event.clientX;
            modalMouseStartY = event.clientY;
        }
        
        // Función para arrastrar con mouse
        function dragImage(event) {
            if (modalIsMouseSwipe) {
                const deltaX = event.clientX - modalMouseStartX;
                const deltaY = event.clientY - modalMouseStartY;
                
                // Solo procesar swipe horizontal
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    event.preventDefault();
                }
            }
        }
        
        // Función para terminar arrastre con mouse
        function endImageDrag() {
            if (modalIsMouseSwipe) {
                const deltaX = event.clientX - modalMouseStartX;
                const deltaY = event.clientY - modalMouseStartY;
                
                // Solo procesar swipe horizontal
                if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > modalSwipeThreshold) {
                    if (deltaX > 0) {
                        // Swipe derecha - imagen anterior
                        if (currentImageIndex > 0) {
                            goToZoomImage(currentImageIndex - 1);
                        }
                    } else {
                        // Swipe izquierda - imagen siguiente
                        if (currentImageIndex < carouselImages.length - 1) {
                            goToZoomImage(currentImageIndex + 1);
                        }
                    }
                }
            }
            
            modalIsMouseSwipe = false;
        }
        
        // Variables para gestos del carrusel
        let modalStartX = 0;
        let modalStartY = 0;
        let modalIsSwipe = false;
        let modalSwipeThreshold = 50;
        
        // Función para manejar toques del carrusel
        function handleTouchStart(event) {
            modalTouches = Array.from(event.touches);
            
            if (modalTouches.length === 1) {
                // Un dedo - iniciar swipe
                modalIsSwipe = true;
                modalStartX = modalTouches[0].clientX;
                modalStartY = modalTouches[0].clientY;
            }
        }
        
        function handleTouchMove(event) {
            if (modalIsSwipe && modalTouches.length === 1) {
                const currentX = modalTouches[0].clientX;
                const currentY = modalTouches[0].clientY;
                const deltaX = currentX - modalStartX;
                const deltaY = currentY - modalStartY;
                
                // Solo procesar swipe horizontal
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    event.preventDefault();
                }
            }
        }
        
        function handleTouchEnd(event) {
            if (modalIsSwipe && modalTouches.length === 1) {
                const currentX = modalTouches[0].clientX;
                const currentY = modalTouches[0].clientY;
                const deltaX = currentX - modalStartX;
                const deltaY = currentY - modalStartY;
                
                // Solo procesar swipe horizontal
                if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > modalSwipeThreshold) {
                    if (deltaX > 0) {
                        // Swipe derecha - imagen anterior
                        if (currentImageIndex > 0) {
                            goToZoomImage(currentImageIndex - 1);
                        }
                    } else {
                        // Swipe izquierda - imagen siguiente
                        if (currentImageIndex < carouselImages.length - 1) {
                            goToZoomImage(currentImageIndex + 1);
                        }
                    }
                }
            }
            
            modalIsSwipe = false;
        }
        
        // Función para calcular distancia entre dos puntos
        function getDistance(touch1, touch2) {
            const dx = touch1.clientX - touch2.clientX;
            const dy = touch1.clientY - touch2.clientY;
            return Math.sqrt(dx * dx + dy * dy);
        }
        
        // Función para actualizar transformación de imagen
        function updateModalImageTransform(img) {
            img.style.transform = `scale(${modalCurrentScale}) translate(${modalTranslateX/modalCurrentScale}px, ${modalTranslateY/modalCurrentScale}px)`;
        }
        
        // Función para detectar imágenes dinámicamente
        async function loadModalAdditionalImages() {
            if (carouselImages.length === 0) return;
            
            const basePath = carouselImages[0];
            const pathParts = basePath.split('/');
            const fileName = pathParts[pathParts.length - 1];
            const baseName = fileName.split('.')[0];
            const extension = fileName.split('.')[1];
            const folder = pathParts.slice(0, -1).join('/');
            
            const additionalImages = [];
            
            // Buscar imágenes adicionales
            for (let i = 1; i <= 10; i++) {
                const imagePath = `${folder}/${baseName}${i}.${extension}`;
                try {
                    const response = await fetch(imagePath, { method: 'HEAD' });
                    if (response.ok) {
                        additionalImages.push(imagePath);
                    }
                } catch (error) {
                    // Imagen no existe, continuar
                }
            }
            
            // Agregar imágenes adicionales al array principal
            carouselImages.push(...additionalImages);
            
            // Actualizar el carrusel
            updateModalCarouselDisplay();
        }
        
        // Función para actualizar la visualización del carrusel
        function updateModalCarouselDisplay() {
            const dotsContainer = document.getElementById('zoomCarouselDots');
            
            // Mostrar/ocultar dots
            if (carouselImages.length > 1) {
                if (dotsContainer) {
                    dotsContainer.style.display = 'flex';
                    dotsContainer.innerHTML = '';
                    carouselImages.forEach((_, index) => {
                        const dot = document.createElement('div');
                        dot.className = `dot ${index === currentImageIndex ? 'active' : ''}`;
                        dot.onclick = () => goToZoomImage(index);
                        dotsContainer.appendChild(dot);
                    });
                }
            } else {
                if (dotsContainer) {
                    dotsContainer.style.display = 'none';
                }
            }
        }
        
        function openImageZoomModalFromOverlay() {
            if (overlayProductImages.length > 0) {
                // Configurar las variables globales del modal de zoom
                carouselImages = [...overlayProductImages];
                currentImageIndex = overlayCurrentImageIndex;
                currentProductColor = overlayCurrentProductColor;
                currentProductType = overlayCurrentProductType;
                
                // Limpiar información anterior del modal
                const productNameEl = document.getElementById('zoomProductName');
                const productDetailsEl = document.getElementById('zoomProductDetails');
                if (productNameEl) productNameEl.textContent = '';
                if (productDetailsEl) productDetailsEl.textContent = '';
                
                // Abrir el modal de zoom
                if (typeof openImageZoomModal === 'function') {
                    openImageZoomModal(overlayCurrentProductColor, overlayProductImages[overlayCurrentImageIndex]);
                } else {
                    // Fallback: abrir directamente el modal
                    const modal = document.getElementById('imageZoomModal');
                    if (modal) {
                        const zoomImage = document.getElementById('zoomImage');
                        if (zoomImage && overlayProductImages[overlayCurrentImageIndex]) {
                            zoomImage.src = overlayProductImages[overlayCurrentImageIndex];
                        }
                        // Asegurar que el modal aparezca encima del overlay
                        modal.style.zIndex = '10001';
                        modal.style.display = 'block';
                    }
                }
            }
        }
        
        // Función para cerrar el overlay
        function closeProductOverlay() {
            document.getElementById('productOverlay').style.display = 'none';
        }
        
        // Funciones para control de cantidad
        function increaseOverlayQuantity() {
            const input = document.getElementById('overlayQuantityInput');
            const currentValue = parseInt(input.value);
            if (currentValue < 50) {
                input.value = currentValue + 1;
                updateOverlayPrice();
            }
        }
        
        function decreaseOverlayQuantity() {
            const input = document.getElementById('overlayQuantityInput');
            const currentValue = parseInt(input.value);
            if (currentValue > 1) {
                input.value = currentValue - 1;
                updateOverlayPrice();
            }
        }
        
        // Función para agregar al carrito desde el overlay (copiada del script.js)
        function addToCartFromOverlay() {
            const quantity = parseInt(document.getElementById('overlayQuantityInput').value);
            const size = document.getElementById('overlaySizeSelect').value;
            const unitPrice = getOverlayUnitPriceFor(quantity, overlayCurrentProductColor);
            let total = unitPrice * quantity;
            
            // Título según tipo
            let titlePrefix = 'Playera Lisa';
            if (overlayCurrentProductType === 'oversize') titlePrefix = 'T-shirt Oversize';
            if (overlayCurrentProductType === 'boxfit') titlePrefix = 'T-shirt Boxfit';
            
            // Crear objeto del producto
            const product = {
                id: Date.now(), // ID único basado en timestamp
                name: `${titlePrefix} - Color ${overlayCurrentProductColor}`,
                color: overlayCurrentProductColor,
                size: size,
                quantity: quantity,
                unitPrice: unitPrice,
                total: total,
                originalTotal: unitPrice * quantity,
                image: overlayCurrentProduct.image
            };
            
            // Buscar si ya existe un producto similar (mismo nombre y talla)
            const existingItemIndex = cartItems.findIndex(item => 
                item.name === product.name && item.size === size
            );
            
            if (existingItemIndex > -1) {
                // Si existe, actualizar cantidad y total
                cartItems[existingItemIndex].quantity += quantity;
                updateCartItemPrice(existingItemIndex);
            } else {
                // Si no existe, agregar nuevo producto
                cartItems.push(product);
            }
            
            // Actualizar UI del carrito
            updateCartBadge();
            updateCartDisplay();
            
            // Guardar en localStorage
            saveCartToLocalStorage();
            
            // Efecto visual en el badge
            const cartBadge = document.querySelectorAll('.badge')[1];
            if (cartBadge) {
                cartBadge.style.transform = 'scale(1.3)';
                cartBadge.style.background = '#4caf50';
                setTimeout(() => {
                    cartBadge.style.transform = 'scale(1)';
                    cartBadge.style.background = '#1e88e5';
                }, 300);
            }
            
            // Cerrar overlay
            closeProductOverlay();
        }
        
        // Agregar event listeners para los dots
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.image-dots .dot').forEach((dot, index) => {
                dot.addEventListener('click', () => {
                    changeOverlayImage(index);
                });
            });
        });
        
        // Funciones de compatibilidad para redireccionar al overlay
        function openProductImageModalOverlay(productName, imageSource) {
            let price = 25;
            if (productName.includes('Oversize') || productName.includes('Boxfit')) {
                price = 45;
            }
            openProductOverlay(productName, imageSource, price);
        }
        
        function openCartModalOverlay(productName, imageSource) {
            let price = 25;
            if (productName.includes('Oversize') || productName.includes('Boxfit')) {
                price = 45;
            }
            openProductOverlay(productName, imageSource, price);
        }
        
        // Funciones de zoom y drag para el overlay
        function handleOverlayImageZoom(event) {
            event.preventDefault();
            const img = document.getElementById('overlayProductImage');
            const delta = event.deltaY > 0 ? -0.1 : 0.1;
            
            const minScale = 1.0;
            const maxScale = 5;
            
            let newScale = overlayCurrentScale + delta;
            newScale = Math.min(Math.max(minScale, newScale), maxScale);
            
            // Si regresamos al tamaño original, centrar la imagen
            if (newScale === 1) {
                overlayTranslateX = 0;
                overlayTranslateY = 0;
            }
            
            overlayCurrentScale = newScale;
            updateOverlayImageTransform(img);
        }
        
        function startOverlayImageDrag(event) {
            overlayMouseDownTime = Date.now();
            overlayMouseDownX = event.clientX;
            overlayMouseDownY = event.clientY;
            
            if (overlayCurrentScale > 1) {
                overlayIsDragging = true;
                overlayStartX = event.clientX - overlayTranslateX;
                overlayStartY = event.clientY - overlayTranslateY;
                event.preventDefault();
            }
        }
        
        function dragOverlayImage(event) {
            if (overlayIsDragging && overlayCurrentScale > 1) {
                const newTranslateX = event.clientX - overlayStartX;
                const newTranslateY = event.clientY - overlayStartY;
                
                const img = document.getElementById('overlayProductImage');
                const container = img.parentElement;
                const imgRect = img.getBoundingClientRect();
                const containerRect = container.getBoundingClientRect();
                
                const scaledWidth = imgRect.width;
                const scaledHeight = imgRect.height;
                const containerWidth = containerRect.width;
                const containerHeight = containerRect.height;
                
                // Calcular límites máximos de movimiento
                const maxTranslateX = Math.max(0, (scaledWidth - containerWidth) / 2 / overlayCurrentScale);
                const maxTranslateY = Math.max(0, (scaledHeight - containerHeight) / 2 / overlayCurrentScale);
                
                // Aplicar límites
                overlayTranslateX = Math.max(-maxTranslateX, Math.min(maxTranslateX, newTranslateX));
                overlayTranslateY = Math.max(-maxTranslateY, Math.min(maxTranslateY, newTranslateY));
                
                updateOverlayImageTransform(img);
            }
        }
        
        function endOverlayImageDrag(event) {
            const mouseUpTime = Date.now();
            const timeDiff = mouseUpTime - overlayMouseDownTime;
            const distance = Math.sqrt(
                Math.pow(event.clientX - overlayMouseDownX, 2) + 
                Math.pow(event.clientY - overlayMouseDownY, 2)
            );
            
            // Si fue un clic rápido (menos de 200ms) y sin movimiento (menos de 5px), abrir modal
            if (timeDiff < 200 && distance < 5 && !overlayIsDragging) {
                openImageZoomModalFromOverlay();
            }
            
            overlayIsDragging = false;
        }
        
        function updateOverlayImageTransform(img) {
            img.style.transform = `scale(${overlayCurrentScale}) translate(${overlayTranslateX/overlayCurrentScale}px, ${overlayTranslateY/overlayCurrentScale}px)`;
        }
        
        // Función para calcular la distancia entre dos puntos táctiles
        function getOverlayDistance(touch1, touch2) {
            const dx = touch1.clientX - touch2.clientX;
            const dy = touch1.clientY - touch2.clientY;
            return Math.sqrt(dx * dx + dy * dy);
        }
        
        // Función para manejar el inicio del toque en overlay
        function handleOverlayTouchStart(event) {
            event.preventDefault();
            overlayTouches = Array.from(event.touches);
            
            if (overlayTouches.length === 1) {
                // Detectar doble toque para resetear zoom
                const currentTime = new Date().getTime();
                const timeDiff = currentTime - overlayLastTouchTime;
                
                if (timeDiff < 300 && timeDiff > 0) {
                    // Doble toque detectado - resetear zoom
                    resetOverlayImageZoom();
                    return;
                }
                
                overlayLastTouchTime = currentTime;
                
                // Un dedo - preparar para arrastre
                if (overlayCurrentScale > 1) {
                    overlayIsDragging = true;
                    overlayStartX = overlayTouches[0].clientX - overlayTranslateX;
                    overlayStartY = overlayTouches[0].clientY - overlayTranslateY;
                }
                
                // Guardar posición inicial para detectar swipe
                overlaySwipeStartX = overlayTouches[0].clientX;
                overlaySwipeStartY = overlayTouches[0].clientY;
            } else if (overlayTouches.length === 2) {
                // Dos dedos - preparar para zoom
                overlayIsZooming = true;
                overlayIsDragging = false;
                overlayInitialDistance = getOverlayDistance(overlayTouches[0], overlayTouches[1]);
                overlayInitialScale = overlayCurrentScale;
                overlayLastTouchDistance = overlayInitialDistance;
            }
        }
        
        // Función para manejar el movimiento del toque en overlay
        function handleOverlayTouchMove(event) {
            event.preventDefault();
            overlayTouches = Array.from(event.touches);
            const img = document.getElementById('overlayProductImage');
            
            if (overlayTouches.length === 1 && overlayIsDragging && overlayCurrentScale > 1) {
                // Un dedo - arrastrar
                const newTranslateX = overlayTouches[0].clientX - overlayStartX;
                const newTranslateY = overlayTouches[0].clientY - overlayStartY;
                
                const container = img.parentElement;
                const imgRect = img.getBoundingClientRect();
                const containerRect = container.getBoundingClientRect();
                
                const scaledWidth = imgRect.width;
                const scaledHeight = imgRect.height;
                const containerWidth = containerRect.width;
                const containerHeight = containerRect.height;
                
                // Calcular límites máximos de movimiento
                const maxTranslateX = Math.max(0, (scaledWidth - containerWidth) / 2 / overlayCurrentScale);
                const maxTranslateY = Math.max(0, (scaledHeight - containerHeight) / 2 / overlayCurrentScale);
                
                // Aplicar límites
                overlayTranslateX = Math.max(-maxTranslateX, Math.min(maxTranslateX, newTranslateX));
                overlayTranslateY = Math.max(-maxTranslateY, Math.min(maxTranslateY, newTranslateY));
                
                updateOverlayImageTransform(img);
            } else if (overlayTouches.length === 2 && overlayIsZooming) {
                // Dos dedos - zoom
                const currentDistance = getOverlayDistance(overlayTouches[0], overlayTouches[1]);
                const scaleChange = currentDistance / overlayInitialDistance;
                
                // Límites de zoom
                const minScale = 1.0;
                const maxScale = 5;
                
                let newScale = overlayInitialScale * scaleChange;
                newScale = Math.min(Math.max(minScale, newScale), maxScale);
                
                // Si regresamos al tamaño original, centrar la imagen
                if (newScale === 1) {
                    overlayTranslateX = 0;
                    overlayTranslateY = 0;
                }
                
                overlayCurrentScale = newScale;
                updateOverlayImageTransform(img);
            }
        }
        
        // Función para manejar el fin del toque en overlay
        function handleOverlayTouchEnd(event) {
            event.preventDefault();
            overlayTouches = Array.from(event.touches);
            
            if (overlayTouches.length === 0) {
                // No hay más toques - verificar si fue un toque simple o swipe
                const touchEndTime = Date.now();
                const timeDiff = touchEndTime - overlayLastTouchTime;
                
                // Detectar swipe horizontal para cambiar imagen
                const deltaX = event.changedTouches[0].clientX - overlaySwipeStartX;
                const deltaY = event.changedTouches[0].clientY - overlaySwipeStartY;
                
                // Si el movimiento horizontal es mayor que el vertical y supera el umbral
                if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > overlaySwipeThreshold) {
                    if (deltaX > 0) {
                        // Swipe hacia la derecha - imagen anterior
                        prevOverlayImage();
                    } else {
                        // Swipe hacia la izquierda - imagen siguiente
                        nextOverlayImage();
                    }
                } else if (timeDiff < 300 && !overlayIsZooming && !overlayIsDragging) {
                    // Si fue un toque simple (no zoom, no drag), abrir modal
                    openImageZoomModalFromOverlay();
                }
                
                overlayIsDragging = false;
                overlayIsZooming = false;
                overlayInitialDistance = 0;
                overlayInitialScale = 1;
            } else if (overlayTouches.length === 1) {
                // Queda un dedo - cambiar de zoom a arrastre si está ampliado
                overlayIsZooming = false;
                if (overlayCurrentScale > 1) {
                    overlayIsDragging = true;
                    overlayStartX = overlayTouches[0].clientX - overlayTranslateX;
                    overlayStartY = overlayTouches[0].clientY - overlayTranslateY;
                }
            }
        }
        
        // Función para resetear zoom en overlay
        function resetOverlayImageZoom() {
            overlayCurrentScale = 1;
            overlayTranslateX = 0;
            overlayTranslateY = 0;
            overlayIsDragging = false;
            overlayIsZooming = false;
            overlayInitialDistance = 0;
            overlayInitialScale = 1;
            overlayTouches = [];
            
            const img = document.getElementById('overlayProductImage');
            if (img) {
                img.style.transform = 'scale(1) translate(0px, 0px)';
            }
        }
        
        // Modificar la función de cambio de imagen para resetear zoom
        function changeOverlayImage(index) {
            if (index >= 0 && index < overlayProductImages.length) {
                overlayCurrentImageIndex = index;
                document.getElementById('overlayProductImage').src = overlayProductImages[index];
                
                // Actualizar dots
                document.querySelectorAll('.image-dots .dot').forEach((dot, i) => {
                    dot.classList.toggle('active', i === index);
                });
                
                // Resetear zoom al cambiar imagen
                setTimeout(resetOverlayImageZoom, 100);
            }
        }
        
        // Modificar la función de abrir overlay para resetear zoom
        function openProductOverlay(productName, imageSource, price) {
            // Determinar la ruta correcta de la imagen
            let imagePath;
            if (imageSource.startsWith('./images/')) {
                imagePath = imageSource;
            } else {
                imagePath = `./images/camisas lisas/${imageSource}.png`;
            }
            
            // Configurar variables del producto
            overlayCurrentProductColor = productName;
            overlayCurrentProductType = 'lisa'; // Por defecto
            
            // Detectar tipo de producto
            if (productName.includes('Oversize')) {
                overlayCurrentProductType = 'oversize';
            } else if (productName.includes('Boxfit')) {
                overlayCurrentProductType = 'boxfit';
            }
            
            // Detectar imágenes disponibles para este producto
            overlayProductImages = detectOverlayAvailableImages(productName, imageSource);
            overlayCurrentImageIndex = 0;
            
            // Configurar la información del producto
            document.getElementById('overlayProductSku').textContent = 'DOGIMA LUXE';
            document.getElementById('overlayProductTitle').textContent = productName.toUpperCase();
            document.getElementById('overlayProductDescription').textContent = 'Playera de alta calidad, 100% algodón, perfecta para cualquier ocasión. Diseño moderno y cómodo.';
            
            // Configurar imagen principal
            document.getElementById('overlayProductImage').src = overlayProductImages[0];
            
            // Configurar dots inicial
            setupOverlayDots();
            
            // Cargar imágenes adicionales de forma asíncrona
            loadOverlayAdditionalImages();
            
            // Resetear valores del formulario
            document.getElementById('overlaySizeSelect').value = 'M';
            document.getElementById('overlayQuantityInput').value = '1';
            document.getElementById('overlayDiscountApplied').style.display = 'none';
            document.getElementById('overlayDiscountInfo').style.display = 'none';
            
            // Guardar datos del producto actual
            overlayCurrentProduct = {
                name: productName,
                image: imagePath,
                price: price
            };
            
            // Actualizar precio inicial
            updateOverlayPrice();
            
            // Mostrar el overlay
            document.getElementById('productOverlay').style.display = 'flex';
            
            // Resetear zoom
            setTimeout(resetOverlayImageZoom, 100);
        }
        
        // Agregar doble clic para resetear zoom en overlay y navegación con teclado
        document.addEventListener('DOMContentLoaded', function() {
            const overlayImg = document.getElementById('overlayProductImage');
            if (overlayImg) {
                overlayImg.addEventListener('dblclick', function() {
                    resetOverlayImageZoom();
                });
            }
            
            // Navegación con teclado
            document.addEventListener('keydown', function(event) {
                const overlay = document.getElementById('productOverlay');
                if (overlay && overlay.style.display === 'flex') {
                    if (event.key === 'ArrowLeft') {
                        event.preventDefault();
                        previousOverlayImage();
                    } else if (event.key === 'ArrowRight') {
                        event.preventDefault();
                        nextOverlayImage();
                    } else if (event.key === 'Escape') {
                        event.preventDefault();
                        closeProductOverlay();
                    }
                }
            });
        });

        // JavaScript del Carrusel
        let currentSlide = 0;
        const cardsPerView = 4;
        const track = document.getElementById('carouselTrack');
        const totalCards = track.children.length;
        const maxSlides = Math.max(0, totalCards - cardsPerView);

        function updateCarousel() {
            const translateX = -currentSlide * (200 + 15); // 200px card width + 15px gap
            track.style.transform = `translateX(${translateX}px)`;
        }

        function nextSlide() {
            if (currentSlide < maxSlides) {
                currentSlide++;
                updateCarousel();
            }
        }

        function prevSlide() {
            if (currentSlide > 0) {
                currentSlide--;
                updateCarousel();
            }
        }

        // Inicializar carrusel
        updateCarousel();

        // Funciones adicionales para el overlay personalizado
        function handlePersonalizedImageZoom(event) {
            event.preventDefault();
            const img = event.target;
            const delta = event.deltaY > 0 ? -0.1 : 0.1;
            const currentScale = parseFloat(img.style.transform.match(/scale\(([^)]+)\)/) || [0, 1])[1];
            const newScale = Math.max(0.5, Math.min(3, currentScale + delta));
            img.style.transform = `scale(${newScale})`;
        }

        function startPersonalizedImageDrag(event) {
            if (event.button === 0) { // Solo botón izquierdo
                const img = event.target;
                img.isDragging = true;
                img.startX = event.clientX - parseFloat(img.style.transform.match(/translateX\(([^)]+)\)/) || [0, 0])[1];
                img.startY = event.clientY - parseFloat(img.style.transform.match(/translateY\(([^)]+)\)/) || [0, 0])[1];
                event.preventDefault();
            }
        }

        function dragPersonalizedImage(event) {
            const img = event.target;
            if (img.isDragging) {
                const x = event.clientX - img.startX;
                const y = event.clientY - img.startY;
                const currentScale = parseFloat(img.style.transform.match(/scale\(([^)]+)\)/) || [0, 1])[1];
                img.style.transform = `scale(${currentScale}) translate(${x}px, ${y}px)`;
                event.preventDefault();
            }
        }

        function endPersonalizedImageDrag(event) {
            const img = event.target;
            img.isDragging = false;
        }

        function handlePersonalizedTouchStart(event) {
            if (event.touches.length === 1) {
                const img = event.target;
                img.touchStartX = event.touches[0].clientX;
                img.touchStartY = event.touches[0].clientY;
                img.startTransformX = parseFloat(img.style.transform.match(/translateX\(([^)]+)\)/) || [0, 0])[1];
                img.startTransformY = parseFloat(img.style.transform.match(/translateY\(([^)]+)\)/) || [0, 0])[1];
            }
        }

        function handlePersonalizedTouchMove(event) {
            if (event.touches.length === 1) {
                const img = event.target;
                const deltaX = event.touches[0].clientX - img.touchStartX;
                const deltaY = event.touches[0].clientY - img.touchStartY;
                const currentScale = parseFloat(img.style.transform.match(/scale\(([^)]+)\)/) || [0, 1])[1];
                img.style.transform = `scale(${currentScale}) translate(${img.startTransformX + deltaX}px, ${img.startTransformY + deltaY}px)`;
                event.preventDefault();
            }
        }

        function handlePersonalizedTouchEnd(event) {
            // Touch end logic
        }

    </script>
    
    <!-- Funciones globales para el overlay personalizado -->
    <script>
        // Variables globales para el modal de zoom
        let currentProductColor = '';
        let currentProductImage = '';
        let currentProductType = 'lisa'; // lisa | oversize | boxfit
        let carouselImages = [];
        let currentImageIndex = 0;
        
        // Variables para gestos táctiles
        let touchStartX = 0;
        let touchEndX = 0;
        let isGestureEnabled = false;
        
        // Variables del carrito
        let cartItems = JSON.parse(localStorage.getItem('dogimaCartItems')) || [];

        // JavaScript para Overlay Personalizado - Funciones globales
        function openPersonalizedOverlay() {
            console.log('openPersonalizedOverlay ejecutándose...');
            
            const overlay = document.getElementById('personalizedOverlay');
            if (!overlay) {
                console.error('Elemento personalizedOverlay no encontrado');
                return;
            }
            
            console.log('Mostrando overlay personalizado');
            overlay.style.display = 'flex';
            overlay.style.zIndex = '9999';
            document.body.style.overflow = 'hidden';
            
            // Asegurar que los colores se actualicen cuando se abra el overlay
            setTimeout(() => {
                console.log('Actualizando colores después de abrir overlay');
                try {
                    updatePersonalizedColors();
                } catch (error) {
                    console.error('Error al actualizar colores:', error);
                }
            }, 100);
        }

        function closePersonalizedOverlay() {
            document.getElementById('personalizedOverlay').style.display = 'none';
            document.body.style.overflow = 'auto';
        }




        // Función para actualizar colores disponibles según el tipo de playera
        function updatePersonalizedColors() {
            console.log('updatePersonalizedColors ejecutándose...');
            
            const typeSelect = document.getElementById('personalizedTypeSelect');
            const colorSelect = document.getElementById('personalizedColorSelect');
            
            if (!typeSelect || !colorSelect) {
                console.log('Elementos no encontrados:', { typeSelect, colorSelect });
                return;
            }
            
            const selectedType = typeSelect.value;
            const currentColor = colorSelect.value;
            
            console.log('Tipo seleccionado:', selectedType, 'Color actual:', currentColor);
            console.log('Opciones ANTES de limpiar:', colorSelect.options.length);
            
            // Limpiar opciones actuales
            colorSelect.innerHTML = '';
            console.log('Opciones DESPUÉS de limpiar:', colorSelect.options.length);
            
            // Obtener colores desde JSON
            let availableColors = [];
            if (window.dataLoader && window.dataLoader.loaded) {
                availableColors = window.dataLoader.getColors(selectedType);
                console.log(`Colores para ${selectedType} desde JSON:`, availableColors.length);
            } else {
                console.log('DataLoader no está cargado, usando colores por defecto');
                // Fallback a colores hardcodeados si JSON no está disponible
                if (selectedType === 'lisa') {
                    availableColors = [
                        { value: 'blanco', text: 'Blanco' },
                        { value: 'negro', text: 'Negro' },
                        { value: 'celeste', text: 'Celeste' },
                        { value: 'rojo', text: 'Rojo' },
                        { value: 'verde', text: 'Verde' },
                        { value: 'gris', text: 'Gris' },
                        { value: 'azul', text: 'Azul' },
                        { value: 'amarillo', text: 'Amarillo' },
                        { value: 'naranja', text: 'Naranja' },
                        { value: 'corinto', text: 'Corinto' },
                        { value: 'fucsia', text: 'Fucsia' },
                        { value: 'verdemilitar', text: 'Verde Militar' }
                    ];
                } else if (selectedType === 'oversize' || selectedType === 'boxfit') {
                    availableColors = [
                        { value: 'blanco', text: 'Blanco' },
                        { value: 'negro', text: 'Negro' },
                        { value: 'crema', text: 'Crema' },
                        { value: 'beige', text: 'Beige' }
                    ];
                } else if (selectedType === 'hoodie_con_capucha' || selectedType === 'hoodie_sin_capucha') {
                    availableColors = [
                        { value: 'blanco', text: 'Blanco' },
                        { value: 'negro', text: 'Negro' }
                    ];
                }
            }
            
            // Agregar las opciones al select
            availableColors.forEach((color, index) => {
                const option = document.createElement('option');
                option.value = color.value;
                option.textContent = color.text;
                colorSelect.appendChild(option);
                console.log(`Agregando opción ${index + 1}:`, color.value, color.text);
            });
            
            // Si el color actual no está disponible en el nuevo tipo, seleccionar el primero disponible
            const isCurrentColorAvailable = availableColors.some(color => color.value === currentColor);
            if (!isCurrentColorAvailable && availableColors.length > 0) {
                colorSelect.value = availableColors[0].value;
                console.log('Color cambiado a:', availableColors[0].value);
            } else {
                console.log('Color actual mantenido:', currentColor);
            }
            
            console.log('Colores actualizados. Total opciones:', colorSelect.options.length);
            console.log('Valor seleccionado actual:', colorSelect.value);
            
            // Forzar actualización visual
            colorSelect.style.display = 'none';
            colorSelect.offsetHeight; // Trigger reflow
            colorSelect.style.display = 'block';
            
            // Actualizar tipo de hilo automáticamente según el tipo de playera
            updatePersonalizedThread();
            
            // Actualizar precio después del cambio
            updatePersonalizedPrice();
        }

        // Función para abrir el modal de zoom desde las tarjetas de productos
        function openProductImageModal(colorName, imageId) {
            // Detectar tipo de producto basado en el nombre del color o imagen
            const name = (colorName || '').toLowerCase();
            if (name.includes('oversize')) {
                currentProductType = 'oversize';
            } else if (name.includes('boxfit')) {
                currentProductType = 'boxfit';
            } else {
                currentProductType = 'lisa';
            }
            
            // Configurar variables globales
            currentProductColor = colorName;
            currentProductImage = '';
            
            // Detectar imágenes disponibles para el carrusel
            carouselImages = detectAvailableImages(colorName, imageId);
            currentImageIndex = 0;
            
            // Configurar el modal de zoom
            document.getElementById('zoomImage').src = carouselImages[currentImageIndex] || '';
            document.getElementById('zoomProductName').textContent = colorName;
            
            // Configurar información del producto según el tipo
            let productInfo = 'Algodón en hilo 20 - Tallas Disponibles: S, M, L y XL'; // Camisas lisas
            if (currentProductType === 'oversize' || currentProductType === 'boxfit') {
                productInfo = 'Algodón en hilo 22 - Tallas Disponibles: S, M, L y XL'; // Oversize y Boxfit
            }
            document.getElementById('zoomProductDetails').textContent = productInfo;
            
            // Mostrar el modal
            document.getElementById('imageZoomModal').style.display = 'block';
        }

        // Función para detectar imágenes disponibles
        function detectAvailableImages(colorName, imageId) {
            const images = [];
            
            // Obtener carpeta y extensión según el tipo de producto
            let imageFolder = 'camisas lisas';
            let extension = '.png';
            
            if (currentProductType === 'oversize') {
                imageFolder = 'overside';
                extension = '.jpg';
            } else if (currentProductType === 'boxfit') {
                imageFolder = 'T-shirt Boxifit';
                extension = '.jpg';
            }
            
            // Si imageId ya es una ruta completa, usarla
            if (imageId && (imageId.includes('/') || imageId.includes('.'))) {
                images.push(imageId);
                return images;
            }
            
            // Usar el nombre exacto del archivo base
            const baseFileName = imageId || colorName.toLowerCase();
            
            // Solo agregar la imagen base por defecto
            const baseImagePath = `./images/${imageFolder}/${baseFileName}${extension}`;
            images.push(baseImagePath);
            
            console.log('Imagen detectada:', baseImagePath);
            
            return images;
        }

        // Función para actualizar el tipo de hilo automáticamente
        function updatePersonalizedThread() {
            const typeSelect = document.getElementById('personalizedTypeSelect');
            const threadSelect = document.getElementById('personalizedThreadSelect');
            
            if (!typeSelect || !threadSelect) return;
            
            const selectedType = typeSelect.value;
            
            console.log('Actualizando tipo de hilo para:', selectedType);
            
            // Obtener hilo por defecto desde JSON
            let defaultThread = 'hilo22'; // Fallback por defecto
            
            if (window.dataLoader && window.dataLoader.loaded) {
                defaultThread = window.dataLoader.getDefaultThread(selectedType);
                console.log(`Hilo por defecto para ${selectedType} desde JSON:`, defaultThread);
            } else {
                console.log('DataLoader no está cargado, usando hilos por defecto');
                // Fallback a lógica hardcodeada
                if (selectedType === 'lisa') {
                    defaultThread = 'hilo22';
                } else if (selectedType === 'oversize' || selectedType === 'boxfit' || 
                          selectedType === 'hoodie_con_capucha' || selectedType === 'hoodie_sin_capucha') {
                    defaultThread = 'hilo20';
                }
            }
            
            threadSelect.value = defaultThread;
            
            // Obtener información del hilo para el log
            if (window.dataLoader && window.dataLoader.loaded) {
                const threadInfo = window.dataLoader.getThread(defaultThread);
                if (threadInfo) {
                    console.log(`Hilo cambiado a: ${defaultThread} (Q${threadInfo.price})`);
                }
            } else {
                const price = defaultThread === 'hilo22' ? 75 : 110;
                console.log(`Hilo cambiado a: ${defaultThread} (Q${price})`);
            }
        }
    </script>
    
    <script>
        // Event listeners para el overlay personalizado
        document.addEventListener('DOMContentLoaded', function() {
            const personalizedImage = document.getElementById('personalizedProductImage');
            if (personalizedImage) {
                personalizedImage.addEventListener('wheel', handlePersonalizedImageZoom);
                personalizedImage.addEventListener('mousedown', startPersonalizedImageDrag);
                personalizedImage.addEventListener('mousemove', dragPersonalizedImage);
                personalizedImage.addEventListener('mouseup', endPersonalizedImageDrag);
                personalizedImage.addEventListener('mouseleave', endPersonalizedImageDrag);
                personalizedImage.addEventListener('touchstart', handlePersonalizedTouchStart);
                personalizedImage.addEventListener('touchmove', handlePersonalizedTouchMove);
                personalizedImage.addEventListener('touchend', handlePersonalizedTouchEnd);
            }

            // Event listeners para cambios en selects
            const typeSelect = document.getElementById('personalizedTypeSelect');
            const threadSelect = document.getElementById('personalizedThreadSelect');
            const colorSelect = document.getElementById('personalizedColorSelect');
            const quantityInput = document.getElementById('personalizedQuantityInput');
            
            if (typeSelect) {
                console.log('Configurando event listener para typeSelect');
                
                typeSelect.addEventListener('change', function() {
                    console.log('EVENTO CHANGE DETECTADO en typeSelect:', this.value);
                    updatePersonalizedColors();
                });
                
                // También agregar event listener para input (por si acaso)
                typeSelect.addEventListener('input', function() {
                    console.log('EVENTO INPUT DETECTADO en typeSelect:', this.value);
                    updatePersonalizedColors();
                });
                
                // También agregar event listener para click
                typeSelect.addEventListener('click', function() {
                    console.log('EVENTO CLICK DETECTADO en typeSelect');
                });
                
                // Ejecutar una vez al cargar para establecer el estado inicial
                console.log('Ejecutando updatePersonalizedColors inicial...');
                updatePersonalizedColors();
            } else {
                console.log('typeSelect no encontrado!');
            }
            if (threadSelect) threadSelect.addEventListener('change', updatePersonalizedPrice);
            if (colorSelect) {
                colorSelect.addEventListener('change', updatePersonalizedPrice);
                colorSelect.addEventListener('change', updatePersonalizedImage);
            }
            if (quantityInput) quantityInput.addEventListener('input', updatePersonalizedPrice);
            
            // Inicializar DataLoader
            if (window.dataLoader) {
                console.log('Inicializando DataLoader...');
                window.dataLoader.loadAll().then(success => {
                    if (success) {
                        console.log('DataLoader inicializado correctamente');
                        // Actualizar colores y precios con datos JSON
                        updatePersonalizedColors();
                    } else {
                        console.log('Error al inicializar DataLoader, usando datos por defecto');
                    }
                });
            } else {
                console.log('DataLoader no está disponible');
            }
        });
    </script>
    
    <!-- Funciones globales para el overlay personalizado -->
    <script>
        // Asegurar que las funciones estén disponibles globalmente
        window.openPersonalizedOverlay = function() {
            console.log('openPersonalizedOverlay ejecutándose...');
            
            const overlay = document.getElementById('personalizedOverlay');
            if (!overlay) {
                console.error('Elemento personalizedOverlay no encontrado');
                return;
            }
            
            console.log('Mostrando overlay personalizado');
            overlay.style.display = 'flex';
            overlay.style.zIndex = '9999';
            document.body.style.overflow = 'hidden';
            
            // Asegurar que los colores se actualicen cuando se abra el overlay
            setTimeout(() => {
                console.log('Actualizando colores después de abrir overlay');
                try {
                    if (typeof updatePersonalizedColors === 'function') {
                        updatePersonalizedColors();
                    } else {
                        console.log('updatePersonalizedColors no está disponible aún');
                    }
                } catch (error) {
                    console.error('Error al actualizar colores:', error);
                }
            }, 100);
        };

        window.closePersonalizedOverlay = function() {
            const overlay = document.getElementById('personalizedOverlay');
            if (overlay) {
                overlay.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        };

        // Funciones de touch y drag para el overlay personalizado
        window.handlePersonalizedTouchStart = function(event) {
            // Touch start logic
        };

        window.handlePersonalizedTouchEnd = function(event) {
            // Touch end logic
        };

        window.startPersonalizedImageDrag = function(event) {
            // Mouse down logic
        };

        window.dragPersonalizedImage = function(event) {
            // Mouse move logic
        };

        window.endPersonalizedImageDrag = function(event) {
            // Mouse up/leave logic
        };

        // Función para actualizar colores
        window.updatePersonalizedColors = function() {
            console.log('updatePersonalizedColors ejecutándose...');
            
            const typeSelect = document.getElementById('personalizedTypeSelect');
            const colorSelect = document.getElementById('personalizedColorSelect');
            
            if (!typeSelect || !colorSelect) {
                console.log('Elementos no encontrados:', { typeSelect, colorSelect });
                return;
            }
            
            const selectedType = typeSelect.value;
            const currentColor = colorSelect.value;
            
            console.log('Tipo seleccionado:', selectedType, 'Color actual:', currentColor);
            
            // Limpiar opciones actuales
            colorSelect.innerHTML = '';
            
            // Obtener colores desde JSON
            let availableColors = [];
            if (window.dataLoader && window.dataLoader.loaded) {
                availableColors = window.dataLoader.getColors(selectedType);
                console.log(`Colores para ${selectedType} desde JSON:`, availableColors.length);
            } else {
                console.log('DataLoader no está cargado, usando colores por defecto');
                // Fallback a colores hardcodeados si JSON no está disponible
                if (selectedType === 'lisa') {
                    availableColors = [
                        { value: 'blanco', text: 'Blanco' },
                        { value: 'negro', text: 'Negro' },
                        { value: 'celeste', text: 'Celeste' },
                        { value: 'rojo', text: 'Rojo' },
                        { value: 'verde', text: 'Verde' },
                        { value: 'gris', text: 'Gris' },
                        { value: 'azul', text: 'Azul' },
                        { value: 'amarillo', text: 'Amarillo' },
                        { value: 'naranja', text: 'Naranja' },
                        { value: 'corinto', text: 'Corinto' },
                        { value: 'fucsia', text: 'Fucsia' },
                        { value: 'verdemilitar', text: 'Verde Militar' }
                    ];
                } else if (selectedType === 'oversize' || selectedType === 'boxfit') {
                    availableColors = [
                        { value: 'blanco', text: 'Blanco' },
                        { value: 'negro', text: 'Negro' },
                        { value: 'crema', text: 'Crema' },
                        { value: 'beige', text: 'Beige' }
                    ];
                } else if (selectedType === 'hoodie_con_capucha' || selectedType === 'hoodie_sin_capucha') {
                    availableColors = [
                        { value: 'blanco', text: 'Blanco' },
                        { value: 'negro', text: 'Negro' }
                    ];
                }
            }
            
            // Agregar las opciones al select
            availableColors.forEach((color, index) => {
                const option = document.createElement('option');
                option.value = color.value;
                option.textContent = color.text;
                colorSelect.appendChild(option);
            });
            
            // Si el color actual no está disponible en el nuevo tipo, seleccionar el primero disponible
            const isCurrentColorAvailable = availableColors.some(color => color.value === currentColor);
            if (!isCurrentColorAvailable && availableColors.length > 0) {
                colorSelect.value = availableColors[0].value;
            }
            
            // Actualizar tipo de hilo y precio
            if (typeof updatePersonalizedThread === 'function') {
                updatePersonalizedThread();
            }
            if (typeof updatePersonalizedPrice === 'function') {
                updatePersonalizedPrice();
            }
            
            // Actualizar imagen según la categoría y color seleccionado
            updatePersonalizedImage();
        };
        
        // Funciones para overlays específicos
        
        // Fútbol
        function openFutbolOverlay() {
            document.getElementById('futbolOverlay').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            updateFutbolImage();
        }
        
        function closeFutbolOverlay() {
            document.getElementById('futbolOverlay').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        // Básquetbol
        function openBasqueOverlay() {
            document.getElementById('basqueOverlay').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            updateBasqueImage();
        }
        
        function closeBasqueOverlay() {
            document.getElementById('basqueOverlay').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        // Anime
        function openAnimeOverlay() {
            document.getElementById('animeOverlay').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            updateAnimeImage();
        }
        
        function closeAnimeOverlay() {
            document.getElementById('animeOverlay').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        // Artistas
        function openArtistasOverlay() {
            document.getElementById('artistasOverlay').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            updateArtistasImage();
        }
        
        function closeArtistasOverlay() {
            document.getElementById('artistasOverlay').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Funciones para Fútbol
        function updateFutbolColors() {
            const typeSelect = document.getElementById('futbolTypeSelect');
            const colorSelect = document.getElementById('futbolColorSelect');
            
            if (!typeSelect || !colorSelect) return;
            
            const selectedType = typeSelect.value;
            const currentColor = colorSelect.value;
            
            colorSelect.innerHTML = '';
            
            let availableColors = [];
            if (selectedType === 'lisa') {
                availableColors = [
                    { value: 'blanco', text: 'Blanco' },
                    { value: 'negro', text: 'Negro' },
                    { value: 'celeste', text: 'Celeste' },
                    { value: 'rojo', text: 'Rojo' },
                    { value: 'verde', text: 'Verde' },
                    { value: 'gris', text: 'Gris' },
                    { value: 'azul', text: 'Azul' },
                    { value: 'amarillo', text: 'Amarillo' },
                    { value: 'naranja', text: 'Naranja' },
                    { value: 'corinto', text: 'Corinto' },
                    { value: 'fucsia', text: 'Fucsia' },
                    { value: 'verdemilitar', text: 'Verde Militar' }
                ];
            } else if (selectedType === 'hoodie_con_capucha' || selectedType === 'hoodie_sin_capucha') {
                availableColors = [
                    { value: 'blanco', text: 'Blanco' },
                    { value: 'negro', text: 'Negro' }
                ];
            } else {
                availableColors = [
                    { value: 'blanco', text: 'Blanco' },
                    { value: 'negro', text: 'Negro' },
                    { value: 'crema', text: 'Crema' },
                    { value: 'beige', text: 'Beige' }
                ];
            }
            
            availableColors.forEach(color => {
                const option = document.createElement('option');
                option.value = color.value;
                option.textContent = color.text;
                colorSelect.appendChild(option);
            });
            
            if (!availableColors.some(color => color.value === currentColor) && availableColors.length > 0) {
                colorSelect.value = availableColors[0].value;
            }
            
            updateFutbolThread();
            updateFutbolPrice();
        }
        
        function updateFutbolThread() {
            const typeSelect = document.getElementById('futbolTypeSelect');
            const threadSelect = document.getElementById('futbolThreadSelect');
            
            if (!typeSelect || !threadSelect) return;
            
            const selectedType = typeSelect.value;
            let defaultThread = 'hilo22';
            
            if (selectedType === 'lisa') {
                defaultThread = 'hilo22';
            } else {
                defaultThread = 'hilo20';
            }
            
            threadSelect.value = defaultThread;
            updateFutbolPrice();
        }
        
        function updateFutbolPrice() {
            const quantity = parseInt(document.getElementById('futbolQuantityInput').value);
            const threadSelect = document.getElementById('futbolThreadSelect');
            const selectedThread = threadSelect.value;
            
            let threadPrice = 75;
            if (selectedThread === 'hilo20') {
                threadPrice = 110;
            }
            
            const total = threadPrice * quantity;
            document.getElementById('futbolTotalPrice').textContent = `Q${total}`;
        }
        
        function increaseFutbolQuantity() {
            const input = document.getElementById('futbolQuantityInput');
            const currentValue = parseInt(input.value);
            if (currentValue < 50) {
                input.value = currentValue + 1;
                updateFutbolPrice();
            }
        }
        
        function decreaseFutbolQuantity() {
            const input = document.getElementById('futbolQuantityInput');
            const currentValue = parseInt(input.value);
            if (currentValue > 1) {
                input.value = currentValue - 1;
                updateFutbolPrice();
            }
        }
        
        function addFutbolToCart() {
            const quantity = parseInt(document.getElementById('futbolQuantityInput').value);
            const size = document.getElementById('futbolSizeSelect').value;
            const typeSelect = document.getElementById('futbolTypeSelect');
            const colorSelect = document.getElementById('futbolColorSelect');
            const threadSelect = document.getElementById('futbolThreadSelect');
            
            const productType = typeSelect.value;
            const color = colorSelect.value;
            const thread = threadSelect.value;
            
            let threadPrice = 75;
            if (thread === 'hilo20') {
                threadPrice = 110;
            }
            
            const total = threadPrice * quantity;
            
            const cartItem = {
                id: `futbol_${Date.now()}`,
                name: `Fútbol Personalizada - ${color}`,
                type: productType,
                color: color,
                size: size,
                thread: thread,
                quantity: quantity,
                price: threadPrice,
                total: total,
                isPersonalized: true,
                category: 'futbol'
            };
            
            cartItems.push(cartItem);
            saveCartToLocalStorage();
            updateCartBadge();
            updateCartDisplay();
            
            closeFutbolOverlay();
        }

        // Funciones para Básquetbol
        function updateBasqueColors() {
            const typeSelect = document.getElementById('basqueTypeSelect');
            const colorSelect = document.getElementById('basqueColorSelect');
            
            if (!typeSelect || !colorSelect) return;
            
            const selectedType = typeSelect.value;
            const currentColor = colorSelect.value;
            
            colorSelect.innerHTML = '';
            
            let availableColors = [];
            if (selectedType === 'lisa') {
                availableColors = [
                    { value: 'blanco', text: 'Blanco' },
                    { value: 'negro', text: 'Negro' },
                    { value: 'celeste', text: 'Celeste' },
                    { value: 'rojo', text: 'Rojo' },
                    { value: 'verde', text: 'Verde' },
                    { value: 'gris', text: 'Gris' },
                    { value: 'azul', text: 'Azul' },
                    { value: 'amarillo', text: 'Amarillo' },
                    { value: 'naranja', text: 'Naranja' },
                    { value: 'corinto', text: 'Corinto' },
                    { value: 'fucsia', text: 'Fucsia' },
                    { value: 'verdemilitar', text: 'Verde Militar' }
                ];
            } else if (selectedType === 'hoodie_con_capucha' || selectedType === 'hoodie_sin_capucha') {
                availableColors = [
                    { value: 'blanco', text: 'Blanco' },
                    { value: 'negro', text: 'Negro' }
                ];
            } else {
                availableColors = [
                    { value: 'blanco', text: 'Blanco' },
                    { value: 'negro', text: 'Negro' },
                    { value: 'crema', text: 'Crema' },
                    { value: 'beige', text: 'Beige' }
                ];
            }
            
            availableColors.forEach(color => {
                const option = document.createElement('option');
                option.value = color.value;
                option.textContent = color.text;
                colorSelect.appendChild(option);
            });
            
            if (!availableColors.some(color => color.value === currentColor) && availableColors.length > 0) {
                colorSelect.value = availableColors[0].value;
            }
            
            updateBasqueThread();
            updateBasquePrice();
        }
        
        function updateBasqueThread() {
            const typeSelect = document.getElementById('basqueTypeSelect');
            const threadSelect = document.getElementById('basqueThreadSelect');
            
            if (!typeSelect || !threadSelect) return;
            
            const selectedType = typeSelect.value;
            let defaultThread = 'hilo22';
            
            if (selectedType === 'lisa') {
                defaultThread = 'hilo22';
            } else {
                defaultThread = 'hilo20';
            }
            
            threadSelect.value = defaultThread;
            updateBasquePrice();
        }
        
        function updateBasquePrice() {
            const quantity = parseInt(document.getElementById('basqueQuantityInput').value);
            const threadSelect = document.getElementById('basqueThreadSelect');
            const selectedThread = threadSelect.value;
            
            let threadPrice = 75;
            if (selectedThread === 'hilo20') {
                threadPrice = 110;
            }
            
            const total = threadPrice * quantity;
            document.getElementById('basqueTotalPrice').textContent = `Q${total}`;
        }
        
        function increaseBasqueQuantity() {
            const input = document.getElementById('basqueQuantityInput');
            const currentValue = parseInt(input.value);
            if (currentValue < 50) {
                input.value = currentValue + 1;
                updateBasquePrice();
            }
        }
        
        function decreaseBasqueQuantity() {
            const input = document.getElementById('basqueQuantityInput');
            const currentValue = parseInt(input.value);
            if (currentValue > 1) {
                input.value = currentValue - 1;
                updateBasquePrice();
            }
        }
        
        function addBasqueToCart() {
            const quantity = parseInt(document.getElementById('basqueQuantityInput').value);
            const size = document.getElementById('basqueSizeSelect').value;
            const typeSelect = document.getElementById('basqueTypeSelect');
            const colorSelect = document.getElementById('basqueColorSelect');
            const threadSelect = document.getElementById('basqueThreadSelect');
            
            const productType = typeSelect.value;
            const color = colorSelect.value;
            const thread = threadSelect.value;
            
            let threadPrice = 75;
            if (thread === 'hilo20') {
                threadPrice = 110;
            }
            
            const total = threadPrice * quantity;
            
            const cartItem = {
                id: `basque_${Date.now()}`,
                name: `Básquetbol Personalizada - ${color}`,
                type: productType,
                color: color,
                size: size,
                thread: thread,
                quantity: quantity,
                price: threadPrice,
                total: total,
                isPersonalized: true,
                category: 'basque'
            };
            
            cartItems.push(cartItem);
            saveCartToLocalStorage();
            updateCartBadge();
            updateCartDisplay();
            
            closeBasqueOverlay();
        }

        // Funciones para Anime
        function updateAnimeColors() {
            const typeSelect = document.getElementById('animeTypeSelect');
            const colorSelect = document.getElementById('animeColorSelect');
            
            if (!typeSelect || !colorSelect) return;
            
            const selectedType = typeSelect.value;
            const currentColor = colorSelect.value;
            
            colorSelect.innerHTML = '';
            
            let availableColors = [];
            if (selectedType === 'lisa') {
                availableColors = [
                    { value: 'blanco', text: 'Blanco' },
                    { value: 'negro', text: 'Negro' },
                    { value: 'celeste', text: 'Celeste' },
                    { value: 'rojo', text: 'Rojo' },
                    { value: 'verde', text: 'Verde' },
                    { value: 'gris', text: 'Gris' },
                    { value: 'azul', text: 'Azul' },
                    { value: 'amarillo', text: 'Amarillo' },
                    { value: 'naranja', text: 'Naranja' },
                    { value: 'corinto', text: 'Corinto' },
                    { value: 'fucsia', text: 'Fucsia' },
                    { value: 'verdemilitar', text: 'Verde Militar' }
                ];
            } else if (selectedType === 'hoodie_con_capucha' || selectedType === 'hoodie_sin_capucha') {
                availableColors = [
                    { value: 'blanco', text: 'Blanco' },
                    { value: 'negro', text: 'Negro' }
                ];
            } else {
                availableColors = [
                    { value: 'blanco', text: 'Blanco' },
                    { value: 'negro', text: 'Negro' },
                    { value: 'crema', text: 'Crema' },
                    { value: 'beige', text: 'Beige' }
                ];
            }
            
            availableColors.forEach(color => {
                const option = document.createElement('option');
                option.value = color.value;
                option.textContent = color.text;
                colorSelect.appendChild(option);
            });
            
            if (!availableColors.some(color => color.value === currentColor) && availableColors.length > 0) {
                colorSelect.value = availableColors[0].value;
            }
            
            updateAnimeThread();
            updateAnimePrice();
        }
        
        function updateAnimeThread() {
            const typeSelect = document.getElementById('animeTypeSelect');
            const threadSelect = document.getElementById('animeThreadSelect');
            
            if (!typeSelect || !threadSelect) return;
            
            const selectedType = typeSelect.value;
            let defaultThread = 'hilo22';
            
            if (selectedType === 'lisa') {
                defaultThread = 'hilo22';
            } else {
                defaultThread = 'hilo20';
            }
            
            threadSelect.value = defaultThread;
            updateAnimePrice();
        }
        
        function updateAnimePrice() {
            const quantity = parseInt(document.getElementById('animeQuantityInput').value);
            const threadSelect = document.getElementById('animeThreadSelect');
            const selectedThread = threadSelect.value;
            
            let threadPrice = 75;
            if (selectedThread === 'hilo20') {
                threadPrice = 110;
            }
            
            const total = threadPrice * quantity;
            document.getElementById('animeTotalPrice').textContent = `Q${total}`;
        }
        
        function increaseAnimeQuantity() {
            const input = document.getElementById('animeQuantityInput');
            const currentValue = parseInt(input.value);
            if (currentValue < 50) {
                input.value = currentValue + 1;
                updateAnimePrice();
            }
        }
        
        function decreaseAnimeQuantity() {
            const input = document.getElementById('animeQuantityInput');
            const currentValue = parseInt(input.value);
            if (currentValue > 1) {
                input.value = currentValue - 1;
                updateAnimePrice();
            }
        }
        
        function addAnimeToCart() {
            const quantity = parseInt(document.getElementById('animeQuantityInput').value);
            const size = document.getElementById('animeSizeSelect').value;
            const typeSelect = document.getElementById('animeTypeSelect');
            const colorSelect = document.getElementById('animeColorSelect');
            const threadSelect = document.getElementById('animeThreadSelect');
            
            const productType = typeSelect.value;
            const color = colorSelect.value;
            const thread = threadSelect.value;
            
            let threadPrice = 75;
            if (thread === 'hilo20') {
                threadPrice = 110;
            }
            
            const total = threadPrice * quantity;
            
            const cartItem = {
                id: `anime_${Date.now()}`,
                name: `Anime Personalizada - ${color}`,
                type: productType,
                color: color,
                size: size,
                thread: thread,
                quantity: quantity,
                price: threadPrice,
                total: total,
                isPersonalized: true,
                category: 'anime'
            };
            
            cartItems.push(cartItem);
            saveCartToLocalStorage();
            updateCartBadge();
            updateCartDisplay();
            
            closeAnimeOverlay();
        }

        // Funciones para Artistas
        function updateArtistasColors() {
            const typeSelect = document.getElementById('artistasTypeSelect');
            const colorSelect = document.getElementById('artistasColorSelect');
            
            if (!typeSelect || !colorSelect) return;
            
            const selectedType = typeSelect.value;
            const currentColor = colorSelect.value;
            
            colorSelect.innerHTML = '';
            
            let availableColors = [];
            if (selectedType === 'lisa') {
                availableColors = [
                    { value: 'blanco', text: 'Blanco' },
                    { value: 'negro', text: 'Negro' },
                    { value: 'celeste', text: 'Celeste' },
                    { value: 'rojo', text: 'Rojo' },
                    { value: 'verde', text: 'Verde' },
                    { value: 'gris', text: 'Gris' },
                    { value: 'azul', text: 'Azul' },
                    { value: 'amarillo', text: 'Amarillo' },
                    { value: 'naranja', text: 'Naranja' },
                    { value: 'corinto', text: 'Corinto' },
                    { value: 'fucsia', text: 'Fucsia' },
                    { value: 'verdemilitar', text: 'Verde Militar' }
                ];
            } else if (selectedType === 'hoodie_con_capucha' || selectedType === 'hoodie_sin_capucha') {
                availableColors = [
                    { value: 'blanco', text: 'Blanco' },
                    { value: 'negro', text: 'Negro' }
                ];
            } else {
                availableColors = [
                    { value: 'blanco', text: 'Blanco' },
                    { value: 'negro', text: 'Negro' },
                    { value: 'crema', text: 'Crema' },
                    { value: 'beige', text: 'Beige' }
                ];
            }
            
            availableColors.forEach(color => {
                const option = document.createElement('option');
                option.value = color.value;
                option.textContent = color.text;
                colorSelect.appendChild(option);
            });
            
            if (!availableColors.some(color => color.value === currentColor) && availableColors.length > 0) {
                colorSelect.value = availableColors[0].value;
            }
            
            updateArtistasThread();
            updateArtistasPrice();
        }
        
        function updateArtistasThread() {
            const typeSelect = document.getElementById('artistasTypeSelect');
            const threadSelect = document.getElementById('artistasThreadSelect');
            
            if (!typeSelect || !threadSelect) return;
            
            const selectedType = typeSelect.value;
            let defaultThread = 'hilo22';
            
            if (selectedType === 'lisa') {
                defaultThread = 'hilo22';
            } else {
                defaultThread = 'hilo20';
            }
            
            threadSelect.value = defaultThread;
            updateArtistasPrice();
        }
        
        function updateArtistasPrice() {
            const quantity = parseInt(document.getElementById('artistasQuantityInput').value);
            const threadSelect = document.getElementById('artistasThreadSelect');
            const selectedThread = threadSelect.value;
            
            let threadPrice = 75;
            if (selectedThread === 'hilo20') {
                threadPrice = 110;
            }
            
            const total = threadPrice * quantity;
            document.getElementById('artistasTotalPrice').textContent = `Q${total}`;
        }
        
        function increaseArtistasQuantity() {
            const input = document.getElementById('artistasQuantityInput');
            const currentValue = parseInt(input.value);
            if (currentValue < 50) {
                input.value = currentValue + 1;
                updateArtistasPrice();
            }
        }
        
        function decreaseArtistasQuantity() {
            const input = document.getElementById('artistasQuantityInput');
            const currentValue = parseInt(input.value);
            if (currentValue > 1) {
                input.value = currentValue - 1;
                updateArtistasPrice();
            }
        }
        
        function addArtistasToCart() {
            const quantity = parseInt(document.getElementById('artistasQuantityInput').value);
            const size = document.getElementById('artistasSizeSelect').value;
            const typeSelect = document.getElementById('artistasTypeSelect');
            const colorSelect = document.getElementById('artistasColorSelect');
            const threadSelect = document.getElementById('artistasThreadSelect');
            
            const productType = typeSelect.value;
            const color = colorSelect.value;
            const thread = threadSelect.value;
            
            let threadPrice = 75;
            if (thread === 'hilo20') {
                threadPrice = 110;
            }
            
            const total = threadPrice * quantity;
            
            const cartItem = {
                id: `artistas_${Date.now()}`,
                name: `Artistas Personalizada - ${color}`,
                type: productType,
                color: color,
                size: size,
                thread: thread,
                quantity: quantity,
                price: threadPrice,
                total: total,
                isPersonalized: true,
                category: 'artistas'
            };
            
            cartItems.push(cartItem);
            saveCartToLocalStorage();
            updateCartBadge();
            updateCartDisplay();
            
            closeArtistasOverlay();
        }

        // Funciones para actualizar imágenes usando la lógica original
        
        // Fútbol - Usar la función original con categoría específica
        function updateFutbolImage() {
            window.currentPersonalizedCategory = 'futbol';
            const images = window.detectAvailableImages('futbol', 'futbol1');
            if (images && images.length > 0) {
                const futbolImage = document.getElementById('futbolProductImage');
                if (futbolImage) {
                    futbolImage.src = images[0];
                    futbolImage.alt = `Fútbol Personalizado`;
                }
            }
        }
        
        // Básquetbol - Usar la función original con categoría específica
        function updateBasqueImage() {
            window.currentPersonalizedCategory = 'basque';
            const images = window.detectAvailableImages('basque', 'basquet1');
            if (images && images.length > 0) {
                const basqueImage = document.getElementById('basqueProductImage');
                if (basqueImage) {
                    basqueImage.src = images[0];
                    basqueImage.alt = `Básquetbol Personalizado`;
                }
            }
        }
        
        // Anime - Usar la función original con categoría específica
        function updateAnimeImage() {
            window.currentPersonalizedCategory = 'anime';
            const images = window.detectAvailableImages('anime', 'anime1');
            if (images && images.length > 0) {
                const animeImage = document.getElementById('animeProductImage');
                if (animeImage) {
                    animeImage.src = images[0];
                    animeImage.alt = `Anime Personalizado`;
                }
            }
        }
        
        // Artistas - Usar la función original con categoría específica
        function updateArtistasImage() {
            window.currentPersonalizedCategory = 'artistas';
            const images = window.detectAvailableImages('artistas', 'artistas1');
            if (images && images.length > 0) {
                const artistasImage = document.getElementById('artistasProductImage');
                if (artistasImage) {
                    artistasImage.src = images[0];
                    artistasImage.alt = `Artistas Personalizado`;
                }
            }
        }

        // Función para actualizar el tipo de hilo
        window.updatePersonalizedThread = function() {
            const typeSelect = document.getElementById('personalizedTypeSelect');
            const threadSelect = document.getElementById('personalizedThreadSelect');
            
            if (!typeSelect || !threadSelect) return;
            
            const selectedType = typeSelect.value;
            
            console.log('Actualizando tipo de hilo para:', selectedType);
            
            // Obtener hilo por defecto desde JSON
            let defaultThread = 'hilo22'; // Fallback por defecto
            
            if (window.dataLoader && window.dataLoader.loaded) {
                defaultThread = window.dataLoader.getDefaultThread(selectedType);
                console.log(`Hilo por defecto para ${selectedType} desde JSON:`, defaultThread);
            } else {
                console.log('DataLoader no está cargado, usando hilos por defecto');
                // Fallback a lógica hardcodeada
                if (selectedType === 'lisa') {
                    defaultThread = 'hilo22';
                } else if (selectedType === 'oversize' || selectedType === 'boxfit' || 
                          selectedType === 'hoodie_con_capucha' || selectedType === 'hoodie_sin_capucha') {
                    defaultThread = 'hilo20';
                }
            }
            
            threadSelect.value = defaultThread;
            
            // Obtener información del hilo para el log
            if (window.dataLoader && window.dataLoader.loaded) {
                const threadInfo = window.dataLoader.getThread(defaultThread);
                if (threadInfo) {
                    console.log(`Hilo cambiado a: ${defaultThread} (Q${threadInfo.price})`);
                }
            } else {
                const price = defaultThread === 'hilo22' ? 75 : 110;
                console.log(`Hilo cambiado a: ${defaultThread} (Q${price})`);
            }
        };

        // Función para actualizar precio (usando precio del hilo)
        window.updatePersonalizedPrice = function() {
            const quantity = parseInt(document.getElementById('personalizedQuantityInput').value);
            const threadSelect = document.getElementById('personalizedThreadSelect');
            const selectedThread = threadSelect.value;
            
            // Precio del hilo
            let threadPrice = 75; // Hilo 22 por defecto
            if (selectedThread === 'hilo20') {
                threadPrice = 110;
            }
            
            const total = threadPrice * quantity;
            
            document.getElementById('personalizedTotalPrice').textContent = `Q${total}`;
        };

        // Función para abrir el modal de zoom desde las tarjetas de productos
        window.openProductImageModal = function(colorName, imageId) {
            console.log('openProductImageModal ejecutándose:', colorName, imageId);
            
            // Detectar tipo de producto basado en el nombre del color o imagen
            const name = (colorName || '').toLowerCase();
            if (name.includes('oversize')) {
                currentProductType = 'oversize';
            } else if (name.includes('boxfit')) {
                currentProductType = 'boxfit';
            } else {
                currentProductType = 'lisa';
            }
            
            // Configurar variables globales
            currentProductColor = colorName;
            currentProductImage = '';
            
            // Detectar imágenes disponibles para el carrusel
            carouselImages = detectAvailableImages(colorName, imageId);
            currentImageIndex = 0;
            
            console.log('Imágenes detectadas:', carouselImages);
            
            // Configurar el modal de zoom
            const zoomImage = document.getElementById('zoomImage');
            const zoomProductName = document.getElementById('zoomProductName');
            const zoomProductDetails = document.getElementById('zoomProductDetails');
            
            if (zoomImage && carouselImages.length > 0) {
                zoomImage.src = carouselImages[currentImageIndex];
                console.log('Imagen configurada:', carouselImages[currentImageIndex]);
            }
            
            if (zoomProductName) {
                zoomProductName.textContent = colorName;
            }
            
            // Configurar información del producto según el tipo
            let productInfo = 'Algodón en hilo 20 - Tallas Disponibles: S, M, L y XL'; // Camisas lisas
            if (currentProductType === 'oversize' || currentProductType === 'boxfit') {
                productInfo = 'Algodón en hilo 22 - Tallas Disponibles: S, M, L y XL'; // Oversize y Boxfit
            }
            
            if (zoomProductDetails) {
                zoomProductDetails.textContent = productInfo;
            }
            
            // Mostrar el modal
            const modal = document.getElementById('imageZoomModal');
            if (modal) {
                modal.style.display = 'block';
                console.log('Modal de imagen mostrado');
            } else {
                console.error('Modal de imagen no encontrado');
            }
        };

        // Función para detectar imágenes disponibles
        window.detectAvailableImages = function(colorName, imageId) {
            const images = [];
            
            // Determinar carpeta según la categoría actual
            let imageFolder = 'personalizadas';
            let extension = '.jpg';
            
            // Si hay una categoría específica seleccionada, usar esa carpeta
            if (window.currentPersonalizedCategory && window.currentPersonalizedCategory !== 'general') {
                imageFolder = `personalizadas/${window.currentPersonalizedCategory}`;
            } else {
                // Para la categoría general, usar la lógica original
                imageFolder = 'camisas lisas';
                extension = '.png';
                
                if (currentProductType === 'oversize') {
                    imageFolder = 'overside';
                    extension = '.jpg';
                } else if (currentProductType === 'boxfit') {
                    imageFolder = 'T-shirt Boxifit';
                    extension = '.jpg';
                }
            }
            
            // Si imageId ya es una ruta completa, usarla
            if (imageId && (imageId.includes('/') || imageId.includes('.'))) {
                images.push(imageId);
                return images;
            }
            
            // Usar el nombre exacto del archivo base
            const baseFileName = imageId || colorName.toLowerCase();
            
            // Solo agregar la imagen base por defecto
            const baseImagePath = `./images/${imageFolder}/${baseFileName}${extension}`;
            images.push(baseImagePath);
            
            console.log('Imagen detectada:', baseImagePath);
            
            return images;
        };

        // Función para cerrar el modal de imagen
        window.closeImageZoomModal = function() {
            const modal = document.getElementById('imageZoomModal');
            if (modal) {
                modal.style.display = 'none';
                console.log('Modal de imagen cerrado');
            }
        };

        // Función para verificar si una imagen existe
        window.checkImageExists = function(imagePath) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => resolve(true);
                img.onerror = () => resolve(false);
                img.src = imagePath;
            });
        };

        // Función para cargar imágenes adicionales automáticamente
        window.loadAdditionalImages = async function() {
            if (carouselImages.length === 0) return;
            
            const basePath = carouselImages[0];
            const pathParts = basePath.split('/');
            const fileName = pathParts[pathParts.length - 1];
            const baseName = fileName.split('.')[0];
            const extension = fileName.split('.')[1];
            const folder = pathParts.slice(0, -1).join('/');
            
            const additionalImages = [];
            
            // Verificar imágenes numeradas (crema1.jpg, crema2.jpg, etc.)
            for (let i = 1; i <= 10; i++) {
                const numberedPath = `${folder}/${baseName}${i}.${extension}`;
                
                try {
                    const exists = await checkImageExists(numberedPath);
                    if (exists) {
                        additionalImages.push(numberedPath);
                        console.log('Imagen adicional encontrada:', numberedPath);
                    }
                } catch (error) {
                    // Imagen no existe, continuar
                }
            }
            
            // Agregar imágenes adicionales al array principal
            carouselImages.push(...additionalImages);
            console.log('Total de imágenes cargadas:', carouselImages.length);
            
            // Actualizar el carrusel si hay múltiples imágenes
            updateCarouselDisplay();
        };

        // Función para actualizar la visualización del carrusel
        window.updateCarouselDisplay = function() {
            const dotsContainer = document.getElementById('zoomCarouselDots');
            
            // Actualizar dots si hay múltiples imágenes
            if (carouselImages.length > 1) {
                if (dotsContainer) {
                    dotsContainer.style.display = 'flex';
                    dotsContainer.innerHTML = '';
                    
                    carouselImages.forEach((_, index) => {
                        const dot = document.createElement('div');
                        dot.className = `dot ${index === currentImageIndex ? 'active' : ''}`;
                        dot.onclick = () => goToZoomImage(index);
                        dotsContainer.appendChild(dot);
                    });
                }
            } else {
                if (dotsContainer) {
                    dotsContainer.style.display = 'none';
                }
            }
            
            // Actualizar la imagen actual
            updateZoomCarouselImage();
        };

        // Función para ir a una imagen específica del carrusel
        window.goToZoomImage = function(index) {
            if (index >= 0 && index < carouselImages.length) {
                currentImageIndex = index;
                updateZoomCarouselImage();
            }
        };

        // Función para actualizar la imagen del carrusel de zoom
        window.updateZoomCarouselImage = function() {
            const zoomImageEl = document.getElementById('zoomImage');
            const dots = document.querySelectorAll('#zoomCarouselDots .dot');
            
            if (zoomImageEl && carouselImages[currentImageIndex]) {
                zoomImageEl.src = carouselImages[currentImageIndex];
                console.log('Imagen del carrusel actualizada:', carouselImages[currentImageIndex]);
            }
            
            // Actualizar dots activos
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentImageIndex);
            });
        };

        // Función para ir a imagen anterior en el modal de zoom
        window.previousZoomImage = function() {
            if (carouselImages.length <= 1) return;
            
            currentImageIndex = currentImageIndex > 0 ? currentImageIndex - 1 : carouselImages.length - 1;
            updateZoomCarouselImage();
            console.log('Imagen anterior:', currentImageIndex);
        };

        // Función para ir a imagen siguiente en el modal de zoom
        window.nextZoomImage = function() {
            if (carouselImages.length <= 1) return;
            
            currentImageIndex = currentImageIndex < carouselImages.length - 1 ? currentImageIndex + 1 : 0;
            updateZoomCarouselImage();
            console.log('Imagen siguiente:', currentImageIndex);
        };

        // Función para configurar gestos táctiles
        window.setupTouchGestures = function(container) {
            if (!container) return;
            
            isGestureEnabled = true;
            console.log('Gestos táctiles habilitados para el modal');
        };

        // Función para manejar inicio de toque/click
        window.handleTouchStart = function(e) {
            if (!isGestureEnabled) return;
            touchStartX = e.touches ? e.touches[0].clientX : e.clientX;
            console.log('Touch start:', touchStartX);
        };

        // Función para manejar fin de toque/click
        window.handleTouchEnd = function(e) {
            if (!isGestureEnabled) return;
            touchEndX = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
            handleSwipe();
            console.log('Touch end:', touchEndX);
        };

        // Función para procesar el swipe
        window.handleSwipe = function() {
            const swipeThreshold = 50; // Mínimo de píxeles para considerar un swipe
            const swipeDistance = touchEndX - touchStartX;
            
            console.log('Swipe distance:', swipeDistance);
            
            if (Math.abs(swipeDistance) > swipeThreshold) {
                if (swipeDistance > 0) {
                    // Swipe hacia la derecha - imagen anterior
                    previousZoomImage();
                } else {
                    // Swipe hacia la izquierda - imagen siguiente
                    nextZoomImage();
                }
            }
        };

        // Función para abrir el modal de zoom (usada desde el HTML)
        window.openImageZoomModal = function(productName, productDetails, imageSrc) {
            console.log('openImageZoomModal ejecutándose:', productName, productDetails, imageSrc);
            
            const modal = document.getElementById('imageZoomModal');
            const zoomImage = document.getElementById('zoomImage');
            const zoomProductName = document.getElementById('zoomProductName');
            const zoomProductDetails = document.getElementById('zoomProductDetails');
            
            if (!modal || !zoomImage || !zoomProductName || !zoomProductDetails) {
                console.error('Elementos del modal no encontrados');
                return;
            }
            
            // Configurar variables globales del carrusel
            carouselImages = [imageSrc]; // Empezar con la imagen base
            currentImageIndex = 0;
            currentProductColor = productName;
            
            // Configurar la imagen inicial
            zoomImage.src = imageSrc;
            console.log('Imagen base configurada:', imageSrc);
            
            // Configurar información del producto
            zoomProductName.textContent = productName || 'Producto';
            zoomProductDetails.textContent = productDetails || 'Información del producto';
            
            // Mostrar el modal
            modal.style.display = 'block';
            console.log('Modal de imagen mostrado');
            
            // Habilitar gestos táctiles
            setupTouchGestures(modal);
            
            // Cargar imágenes adicionales en segundo plano
            loadAdditionalImages();
        };

        // Funciones del carrito de compras
        window.saveCartToLocalStorage = function() {
            localStorage.setItem('dogimaCartItems', JSON.stringify(cartItems));
            console.log('Carrito guardado en localStorage');
        };

        window.updateCartBadge = function() {
            const totalItems = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            const cartBadge = document.querySelectorAll('.badge')[1];
            if (cartBadge) {
                cartBadge.textContent = totalItems;
                console.log('Badge del carrito actualizado:', totalItems);
            }
        };

        window.updateCartDisplay = function() {
            const cartItemsContainer = document.getElementById('cartItems');
            const emptyCart = document.getElementById('emptyCart');
            const cartSummary = document.getElementById('cartSummary');
            
            if (!cartItemsContainer) return;
            
            if (cartItems.length === 0) {
                if (emptyCart) emptyCart.style.display = 'block';
                if (cartSummary) cartSummary.style.display = 'none';
                cartItemsContainer.innerHTML = '';
            } else {
                if (emptyCart) emptyCart.style.display = 'none';
                if (cartSummary) cartSummary.style.display = 'block';
                
                cartItemsContainer.innerHTML = '';
                cartItems.forEach((item, index) => {
                    const itemElement = createCartItemElement(item, index);
                    cartItemsContainer.appendChild(itemElement);
                });
                
                updateCartSummary();
            }
        };

        window.createCartItemElement = function(item, index) {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'cart-item';
            
            // Si es un producto personalizado, usar imagen general
            if (item.isPersonalized) {
                itemDiv.innerHTML = `
                    <img src="./images/personalizadas/general.jpg" alt="${item.name}">
                    <div class="cart-item-details">
                        <div class="cart-item-title">${item.name}</div>
                        <div class="cart-item-info">Talla: ${item.size}</div>
                        <div class="cart-item-info">Precio unitario: Q${item.unitPrice}</div>
                        
                        <div class="cart-item-controls">
                            <div class="cart-quantity-display">
                                <span class="quantity-label">Cantidad: ${item.quantity}</span>
                            </div>
                            <button class="btn-remove-item" onclick="removeFromCart(${index})">Eliminar</button>
                        </div>
                    </div>
                    <div class="cart-item-price">
                        <div class="final-price">Q${item.total}</div>
                    </div>
                `;
            } else {
                // Productos normales con imagen
                itemDiv.innerHTML = `
                    <img src="${item.image}" alt="${item.name}">
                    <div class="cart-item-details">
                        <div class="cart-item-title">${item.name}</div>
                        <div class="cart-item-info">Talla: ${item.size}</div>
                        <div class="cart-item-info">Precio unitario: Q${item.unitPrice}</div>
                        
                        <div class="cart-item-controls">
                            <div class="cart-quantity-display">
                                <span class="quantity-label">Cantidad: ${item.quantity}</span>
                            </div>
                            <button class="btn-remove-item" onclick="removeFromCart(${index})">Eliminar</button>
                        </div>
                    </div>
                    <div class="cart-item-price">
                        <div class="final-price">Q${item.total}</div>
                    </div>
                `;
            }
            
            return itemDiv;
        };

        window.updateCartSummary = function() {
            const subtotal = cartItems.reduce((sum, item) => sum + item.total, 0);
            const shipping = 30; // Q30 de envío
            const total = subtotal + shipping;
            const totalItems = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            
            const subtotalEl = document.getElementById('cartSubtotal');
            const shippingEl = document.getElementById('cartShipping');
            const totalEl = document.getElementById('cartTotal');
            const totalItemsEl = document.getElementById('cartTotalItems');
            
            if (subtotalEl) subtotalEl.textContent = `Q${subtotal}`;
            if (shippingEl) shippingEl.textContent = `Q${shipping}`;
            if (totalEl) totalEl.textContent = `Q${total}`;
            if (totalItemsEl) totalItemsEl.textContent = totalItems;
        };

        // Función para obtener precio unitario (copiada del overlay original)
        window.getPersonalizedUnitPriceFor = function(quantity, productType) {
            if (productType === 'oversize' || productType === 'boxfit') {
                if (quantity >= 12) return 35; // Docena
                if (quantity >= 6) return 38;  // Media docena
                return 45; // Individual
            } else {
                // Playeras lisas
                if (quantity >= 12) return 18; // Docena
                return 25; // Individual
            }
        };

        // Función para agregar producto personalizado al carrito (copiada exactamente del overlay original)
        window.addPersonalizedToCart = function() {
            const quantity = parseInt(document.getElementById('personalizedQuantityInput').value);
            const size = document.getElementById('personalizedSizeSelect').value;
            const typeSelect = document.getElementById('personalizedTypeSelect');
            const colorSelect = document.getElementById('personalizedColorSelect');
            
            const selectedType = typeSelect.value;
            const selectedColor = colorSelect.value;
            
            // Obtener precio del hilo seleccionado
            const threadSelect = document.getElementById('personalizedThreadSelect');
            const selectedThread = threadSelect.value;
            
            let threadPrice = 75; // Hilo 22 por defecto
            if (selectedThread === 'hilo20') {
                threadPrice = 110;
            }
            
            const unitPrice = threadPrice;
            let total = unitPrice * quantity;
            
            // Título según tipo
            let titlePrefix = 'Playera Lisa';
            if (selectedType === 'oversize') titlePrefix = 'T-shirt Oversize';
            if (selectedType === 'boxfit') titlePrefix = 'T-shirt Boxfit';
            if (selectedType === 'hoodie_con_capucha') titlePrefix = 'Hoodie con Capucha';
            if (selectedType === 'hoodie_sin_capucha') titlePrefix = 'Hoodie sin Capucha';
            
            // Crear objeto del producto
            const product = {
                id: Date.now(), // ID único basado en timestamp
                name: `${titlePrefix} Personalizada - Color ${selectedColor}`,
                color: selectedColor,
                size: size,
                quantity: quantity,
                unitPrice: unitPrice,
                total: total,
                originalTotal: unitPrice * quantity,
                image: `./images/personalizadas/general.jpg`
            };
            
            // Buscar si ya existe un producto similar (mismo nombre y talla)
            const existingItemIndex = cartItems.findIndex(item => 
                item.name === product.name && item.size === size
            );
            
            if (existingItemIndex > -1) {
                // Si existe, actualizar cantidad y total
                cartItems[existingItemIndex].quantity += quantity;
                cartItems[existingItemIndex].total = cartItems[existingItemIndex].unitPrice * cartItems[existingItemIndex].quantity;
            } else {
                // Si no existe, agregar nuevo producto
                cartItems.push(product);
            }
            
            // Actualizar UI del carrito
            updateCartBadge();
            updateCartDisplay();
            
            // Guardar en localStorage
            saveCartToLocalStorage();
            
            // Efecto visual en el badge
            const cartBadge = document.querySelectorAll('.badge')[1];
            if (cartBadge) {
                cartBadge.style.transform = 'scale(1.3)';
                cartBadge.style.background = '#4caf50';
                setTimeout(() => {
                    cartBadge.style.transform = 'scale(1)';
                    cartBadge.style.background = '#1e88e5';
                }, 300);
            }
            
            // Cerrar overlay
            closePersonalizedOverlay();
        };

        // Funciones adicionales del carrito
        window.removeFromCart = function(index) {
            cartItems.splice(index, 1);
            updateCartDisplay();
            updateCartBadge();
            saveCartToLocalStorage();
        };

        window.clearCart = function() {
            if (cartItems.length > 0) {
                cartItems = [];
                updateCartDisplay();
                updateCartBadge();
                saveCartToLocalStorage();
            }
        };

        window.checkout = function() {
            if (cartItems.length === 0) {
                return;
            }
            
            // Abrir modal de datos del cliente en lugar de ir directamente a WhatsApp
            document.getElementById('customerDataModal').style.display = 'block';
        };

        window.closeCart = function() {
            document.getElementById('shoppingCartModal').style.display = 'none';
        };

        // Funciones de cantidad (al final para asegurar que estén disponibles)
        window.increasePersonalizedQuantity = function() {
            const input = document.getElementById('personalizedQuantityInput');
            const currentValue = parseInt(input.value);
            if (currentValue < 50) {
                input.value = currentValue + 1;
                updatePersonalizedPrice();
            }
        };
        
        window.decreasePersonalizedQuantity = function() {
            const input = document.getElementById('personalizedQuantityInput');
            const currentValue = parseInt(input.value);
            if (currentValue > 1) {
                input.value = currentValue - 1;
                updatePersonalizedPrice();
            }
        };

        // Funciones del modal de datos del cliente
        window.closeCustomerDataModal = function() {
            document.getElementById('customerDataModal').style.display = 'none';
        };

        window.processOrderWithCustomerData = function() {
            // Obtener datos del formulario
            const customerName = document.getElementById('customerName').value.trim();
            const customerPhone = document.getElementById('customerPhone').value.trim();
            const customerAddress = document.getElementById('customerAddress').value.trim();
            
            // Validar que todos los campos estén completos
            if (!customerName || !customerPhone || !customerAddress) {
                alert('Por favor completa todos los campos obligatorios.');
                return;
            }
            
            // Validar formato de teléfono
            const phoneRegex = /^[0-9\s\-\+\(\)]{8,}$/;
            if (!phoneRegex.test(customerPhone)) {
                alert('Por favor ingresa un número de teléfono válido.');
                return;
            }
            
            // Proceder con el pedido
            completeCheckout(customerName, customerPhone, customerAddress);
        };

        window.completeCheckout = function(customerName, customerPhone, customerAddress) {
            // Generar ID del pedido
            const orderId = 'DOG' + Date.now().toString().slice(-6);
            
            // Crear mensaje para WhatsApp con el formato específico
            const subtotal = cartItems.reduce((sum, item) => sum + item.total, 0);
            const shipping = 30;
            const total = subtotal + shipping;
            
            let message = `Hola! Nuevo pedido de DOGIMA Luxe\n\n`;
            message += `Pedido ID: ${orderId}\n`;
            message += `Cliente: ${customerName}\n`;
            message += `Dirección: ${customerAddress}\n`;
            message += `Teléfono: ${customerPhone}\n\n`;
            message += `Detalles del pedido:\n`;
            
            cartItems.forEach((item) => {
                // Extraer el tipo de producto y color del nombre
                let productType = item.name;
                let color = item.color || 'N/A';
                
                // Formatear el nombre del producto para que se vea mejor
                if (productType.includes('Playera Lisa')) {
                    productType = 'Playera Lisa';
                } else if (productType.includes('T-shirt Oversize')) {
                    productType = 'T-shirt Oversize';
                } else if (productType.includes('T-shirt Boxfit')) {
                    productType = 'T-shirt Boxfit';
                } else if (productType.includes('Hoodie con Capucha')) {
                    productType = 'Hoodie con Capucha';
                } else if (productType.includes('Hoodie sin Capucha')) {
                    productType = 'Hoodie sin Capucha';
                }
                
                message += `- ${productType}, Color: ${color}, Talla: ${item.size}, Cantidad: ${item.quantity}, Precio: Q${item.total} c/u\n`;
            });
            
            message += `\nSubtotal: Q${subtotal}\n`;
            message += `Envío: Q${shipping}\n`;
            message += `Total: Q${total}\n\n`;
            message += `Gracias por tu pedido, te contactaremos pronto para coordinar la entrega.`;
            
            // Abrir WhatsApp
            const whatsappUrl = `https://wa.me/50257326695?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            
            // Cerrar modales
            document.getElementById('customerDataModal').style.display = 'none';
            document.getElementById('shoppingCartModal').style.display = 'none';
            
            // Limpiar carrito
            cartItems = [];
            updateCartDisplay();
            updateCartBadge();
            saveCartToLocalStorage();
            
            // Limpiar formulario
            document.getElementById('customerDataForm').reset();
        };

        // Event listener para el formulario de datos del cliente
        document.addEventListener('DOMContentLoaded', function() {
            const customerDataForm = document.getElementById('customerDataForm');
            if (customerDataForm) {
                customerDataForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    processOrderWithCustomerData();
                });
            }
        });
    </script>
</body>
</html>

